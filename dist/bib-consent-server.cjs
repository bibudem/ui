/**
 * Librairie du system desing des Bibliothèques de l'Université de Montréal
 * @module @bibudem/ui
 * @version 1.3.1
 * @author Christian Rémillard <christian.remillard@umontreal.ca>
 * @license ISC
 * @see https://github.com/bibudem/ui
 */
var e,t,o,s,i=Object.defineProperty,n=e=>{throw TypeError(e)},a=(e,t,o)=>((e,t,o)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o)(e,"symbol"!=typeof t?t+"":t,o),r=(e,t,o)=>t.has(e)||n("Cannot "+o),l=(e,t,o)=>(r(e,t,"read from private field"),o?o.call(e):t.get(e)),c=(e,t,o)=>t.has(e)?n("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,o),d=(e,t,o)=>(r(e,t,"access private method"),o);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("./lit-element-BHNMc-Kg.cjs"),g=require("./url-y47v7naU.cjs"),p=require("./ref-mxufyLY8.cjs"),b=require("./logger-BXGZV0ek.cjs"),u=require("./ConsentStorage.cjs");class m extends h.s{constructor(){super(),c(this,o),c(this,e),c(this,t,b.loggerFactory("bib-consent-server")),this.connected=!1,this.debug=this.debug||!1,this.loggerRef=p.e(),this.allowedOrigins=this.allowedOrigins||[],this.init()}async init(){var t,i,n,a;d(this,o,s).call(this,"Initializing BibConsentServer..."),t=this,i=e,n=await u(),r(t,i,"write to private field"),a?a.call(t,n):i.set(t,n),l(this,e).listen((e=>{d(this,o,s).call(this,"Storage updated with data",e.detail)})),d(this,o,s).call(this,"Start listening for storage updates..."),await this.startListening(),d(this,o,s).call(this,"Initialization complete.")}async startListening(){const{listenMessage:t}=await g.startListening({eventFilter:e=>{const{origin:t}=e;return this.allowedOrigins.length>0&&this.allowedOrigins.some((e=>g.patternMatchesOrigin(e,t)))}});this.connected=!0,d(this,o,s).call(this,"Connected:",`<code class="value">${this.connected}</code>`),d(this,o,s).call(this,"Listening for postMessage events..."),t((async(t,i,n)=>{let a;switch(t){case"setConsentTokens":a=await l(this,e).setConsentTokens(i);break;case"getConsentTokens":a=await l(this,e).getConsentTokens();break;case"resetTokens":a=await l(this,e).resetTokens();break;case"ping":a="pong";break;default:throw d(this,o,s).call(this,`Unknown method: <code class="method">${t}</code>. Payload:`,i),new Error(`Unknown method: ${t}`)}i?d(this,o,s).call(this,`Method <code class="method">${t}</code> called with payload:`,i,"response:",a):d(this,o,s).call(this,`Method <code class="method">${t}</code> called.`,"response:",a),n(a)}))}render(){return h.x`<h1>I am bib-consent-server</h1><div class="log-container"><div class="log" ${p.n(this.loggerRef)}></div></div>`}}e=new WeakMap,t=new WeakMap,o=new WeakSet,s=function(...e){if(this.hasAttribute("debug")){const o=e.map((e=>"string"==typeof e?e.replace(/<\/?[^>]+(>|$)/g,""):e));l(this,t).call(this,...o);const s=e.map((e=>"string"==typeof e?e:`<code class="value">${JSON.stringify(e)}</code>`)).join(" ");if(this.loggerRef.value){const e=this.loggerRef.value;e.innerHTML+=`${""===e.innerHTML?"":"<br />"}${s}`,e.scrollTop=e.scrollHeight}}},a(m,"properties",{connected:{type:Boolean},debug:{type:Boolean,reflect:!0},allowedOrigins:{type:String,attribute:"allowed-origins",converter:{fromAttribute:e=>e.split(/\s+/).map((e=>e.trim())),toAttribute:e=>e.join(" ")}}}),a(m,"styles",[h.i`${h.r(":host{display:none}:host([debug]){display:block;height:100vh}body{margin:0}h1{text-align:center;padding:.25em 0;margin:0;font:unset;font-variant:all-small-caps;background-color:#e5e5e5}.log-container{padding:0;font-size:13px;border:1px solid silver}.log{box-sizing:border-box;-webkit-text-size-adjust:100%;font-family:ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace!important;font-size:small;margin:0;padding:.35rem;width:100%;background-color:unset;border:none;tab-size:8;outline:none;overflow-y:auto;height:100px;line-height:20px;overflow-wrap:normal;overscroll-behavior-x:none;z-index:1}.log code{font-size:13px}.log .function,.log .method{color:#881280}.log .property{color:#994500}.log .value{color:#1a1aa6}")}`]),window.customElements.get("bib-consent-server")||window.customElements.define("bib-consent-server",m),exports.BibConsentServer=m;
//# sourceMappingURL=bib-consent-server.cjs.map
