{"version":3,"file":"bib-consent.cjs","sources":["../node_modules/@lit/context/lib/value-notifier.js","../node_modules/@lit/context/lib/controllers/context-provider.js","isObject-Dipzh7kZ.js","_Uint8Array-Cf-PTZCw.js","../src/components/bib-consent/bib-consent.js"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nclass s{get value(){return this.o}set value(s){this.setValue(s)}setValue(s,t=!1){const i=t||!Object.is(s,this.o);this.o=s,i&&this.updateObservers()}constructor(s){this.subscriptions=new Map,this.updateObservers=()=>{for(const[s,{disposer:t}]of this.subscriptions)s(this.o,t)},void 0!==s&&(this.value=s)}addCallback(s,t,i){if(!i)return void s(this.value);this.subscriptions.has(s)||this.subscriptions.set(s,{disposer:()=>{this.subscriptions.delete(s)},consumerHost:t});const{disposer:h}=this.subscriptions.get(s);s(this.value,h)}clearCallbacks(){this.subscriptions.clear()}}export{s as ValueNotifier};\n//# sourceMappingURL=value-notifier.js.map\n","import{ContextRequestEvent as t}from\"../context-request-event.js\";import{ValueNotifier as s}from\"../value-notifier.js\";\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */class e extends Event{constructor(t){super(\"context-provider\",{bubbles:!0,composed:!0}),this.context=t}}class i extends s{constructor(s,e,i){super(void 0!==e.context?e.initialValue:i),this.onContextRequest=t=>{const s=t.composedPath()[0];t.context===this.context&&s!==this.host&&(t.stopPropagation(),this.addCallback(t.callback,s,t.subscribe))},this.onProviderRequest=s=>{const e=s.composedPath()[0];if(s.context!==this.context||e===this.host)return;const i=new Set;for(const[s,{consumerHost:e}]of this.subscriptions)i.has(s)||(i.add(s),e.dispatchEvent(new t(this.context,s,!0)));s.stopPropagation()},this.host=s,void 0!==e.context?this.context=e.context:this.context=e,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener(\"context-request\",this.onContextRequest),this.host.addEventListener(\"context-provider\",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new e(this.context))}}export{i as ContextProvider,e as ContextProviderEvent};\n//# sourceMappingURL=context-provider.js.map\n","/**\n * Librairie du system desing des Bibliothèques de l'Université de Montréal\n * @module @bibudem/ui\n * @version 1.3.0\n * @author Christian Rémillard <christian.remillard@umontreal.ca>\n * @license ISC\n * @see https://github.com/bibudem/ui\n */\nvar t = \"object\" == typeof global && global && global.Object === Object && global, e = \"object\" == typeof self && self && self.Object === Object && self, o = t || e || Function(\"return this\")(), n = o.Symbol, l = Object.prototype, r = l.hasOwnProperty, c = l.toString, a = n ? n.toStringTag : void 0, b = Object.prototype.toString, i = n ? n.toStringTag : void 0;\nfunction u(t2) {\n  return null == t2 ? void 0 === t2 ? \"[object Undefined]\" : \"[object Null]\" : i && i in Object(t2) ? function(t3) {\n    var e2 = r.call(t3, a), o2 = t3[a];\n    try {\n      t3[a] = void 0;\n      var n2 = true;\n    } catch (t4) {\n    }\n    var l2 = c.call(t3);\n    return n2 && (e2 ? t3[a] = o2 : delete t3[a]), l2;\n  }(t2) : function(t3) {\n    return b.call(t3);\n  }(t2);\n}\nfunction f(t2) {\n  return null != t2 && \"object\" == typeof t2;\n}\nfunction j(t2) {\n  var e2 = typeof t2;\n  return null != t2 && (\"object\" == e2 || \"function\" == e2);\n}\nexport {\n  n as S,\n  j as a,\n  u as b,\n  t as f,\n  f as i,\n  o as r\n};\n//# sourceMappingURL=isObject-Dipzh7kZ.js.map\n","/**\n * Librairie du system desing des Bibliothèques de l'Université de Montréal\n * @module @bibudem/ui\n * @version 1.3.0\n * @author Christian Rémillard <christian.remillard@umontreal.ca>\n * @license ISC\n * @see https://github.com/bibudem/ui\n */\nimport { a as t, b as e, r, i as o, f as n } from \"./isObject-Dipzh7kZ.js\";\nvar a = Array.isArray, i = \"[object AsyncFunction]\", s = \"[object Function]\", u = \"[object GeneratorFunction]\", c = \"[object Proxy]\";\nfunction p(r2) {\n  if (!t(r2)) return false;\n  var o2 = e(r2);\n  return o2 == s || o2 == u || o2 == i || o2 == c;\n}\nvar _, h = r[\"__core-js_shared__\"], f = (_ = /[^.]+$/.exec(h && h.keys && h.keys.IE_PROTO || \"\")) ? \"Symbol(src)_1.\" + _ : \"\", l = Function.prototype.toString;\nfunction y(t2) {\n  if (null != t2) {\n    try {\n      return l.call(t2);\n    } catch (t3) {\n    }\n    try {\n      return t2 + \"\";\n    } catch (t3) {\n    }\n  }\n  return \"\";\n}\nvar d = /^\\[object .+?Constructor\\]$/, b = Function.prototype, v = Object.prototype, j = b.toString, g = v.hasOwnProperty, m = RegExp(\"^\" + j.call(g).replace(/[\\\\^$.*+?()[\\]{}|]/g, \"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, \"$1.*?\") + \"$\");\nfunction z(e2, r2) {\n  var o2 = function(t2, e3) {\n    return null == t2 ? void 0 : t2[e3];\n  }(e2, r2);\n  return function(e3) {\n    return !(!t(e3) || (r3 = e3, f && f in r3)) && (p(e3) ? m : d).test(y(e3));\n    var r3;\n  }(o2) ? o2 : void 0;\n}\nvar A = 9007199254740991, O = /^(?:0|[1-9]\\d*)$/;\nfunction x(t2, e2) {\n  var r2 = typeof t2;\n  return !!(e2 = null == e2 ? A : e2) && (\"number\" == r2 || \"symbol\" != r2 && O.test(t2)) && t2 > -1 && t2 % 1 == 0 && t2 < e2;\n}\nfunction w(t2, e2) {\n  return t2 === e2 || t2 != t2 && e2 != e2;\n}\nvar F = 9007199254740991;\nfunction P(t2) {\n  return \"number\" == typeof t2 && t2 > -1 && t2 % 1 == 0 && t2 <= F;\n}\nfunction S(t2) {\n  return null != t2 && P(t2.length) && !p(t2);\n}\nvar $ = Object.prototype;\nfunction T(t2) {\n  var e2 = t2 && t2.constructor;\n  return t2 === (\"function\" == typeof e2 && e2.prototype || $);\n}\nfunction U(t2) {\n  return o(t2) && \"[object Arguments]\" == e(t2);\n}\nvar E = Object.prototype, I = E.hasOwnProperty, k = E.propertyIsEnumerable, B = U(/* @__PURE__ */ function() {\n  return arguments;\n}()) ? U : function(t2) {\n  return o(t2) && I.call(t2, \"callee\") && !k.call(t2, \"callee\");\n}, M = \"object\" == typeof exports && exports && !exports.nodeType && exports, R = M && \"object\" == typeof module && module && !module.nodeType && module, q = R && R.exports === M ? r.Buffer : void 0, C = (q ? q.isBuffer : void 0) || function() {\n  return false;\n}, D = {};\nD[\"[object Float32Array]\"] = D[\"[object Float64Array]\"] = D[\"[object Int8Array]\"] = D[\"[object Int16Array]\"] = D[\"[object Int32Array]\"] = D[\"[object Uint8Array]\"] = D[\"[object Uint8ClampedArray]\"] = D[\"[object Uint16Array]\"] = D[\"[object Uint32Array]\"] = true, D[\"[object Arguments]\"] = D[\"[object Array]\"] = D[\"[object ArrayBuffer]\"] = D[\"[object Boolean]\"] = D[\"[object DataView]\"] = D[\"[object Date]\"] = D[\"[object Error]\"] = D[\"[object Function]\"] = D[\"[object Map]\"] = D[\"[object Number]\"] = D[\"[object Object]\"] = D[\"[object RegExp]\"] = D[\"[object Set]\"] = D[\"[object String]\"] = D[\"[object WeakMap]\"] = false;\nvar G, L = \"object\" == typeof exports && exports && !exports.nodeType && exports, N = L && \"object\" == typeof module && module && !module.nodeType && module, V = N && N.exports === L && n.process, W = function() {\n  try {\n    return N && N.require && N.require(\"util\").types || V && V.binding && V.binding(\"util\");\n  } catch (t2) {\n  }\n}(), H = W && W.isTypedArray, J = H ? (G = H, function(t2) {\n  return G(t2);\n}) : function(t2) {\n  return o(t2) && P(t2.length) && !!D[e(t2)];\n}, K = Object.prototype.hasOwnProperty;\nfunction Q(t2, e2) {\n  var r2 = a(t2), o2 = !r2 && B(t2), n2 = !r2 && !o2 && C(t2), i2 = !r2 && !o2 && !n2 && J(t2), s2 = r2 || o2 || n2 || i2, u2 = s2 ? function(t3, e3) {\n    for (var r3 = -1, o3 = Array(t3); ++r3 < t3; ) o3[r3] = e3(r3);\n    return o3;\n  }(t2.length, String) : [], c2 = u2.length;\n  for (var p2 in t2) !e2 && !K.call(t2, p2) || s2 && (\"length\" == p2 || n2 && (\"offset\" == p2 || \"parent\" == p2) || i2 && (\"buffer\" == p2 || \"byteLength\" == p2 || \"byteOffset\" == p2) || x(p2, c2)) || u2.push(p2);\n  return u2;\n}\nfunction X(t2, e2) {\n  return function(r2) {\n    return t2(e2(r2));\n  };\n}\nvar Y = z(Object, \"create\"), Z = Object.prototype.hasOwnProperty, tt = Object.prototype.hasOwnProperty;\nfunction et(t2) {\n  var e2 = -1, r2 = null == t2 ? 0 : t2.length;\n  for (this.clear(); ++e2 < r2; ) {\n    var o2 = t2[e2];\n    this.set(o2[0], o2[1]);\n  }\n}\nfunction rt(t2, e2) {\n  for (var r2 = t2.length; r2--; ) if (w(t2[r2][0], e2)) return r2;\n  return -1;\n}\net.prototype.clear = function() {\n  this.__data__ = Y ? Y(null) : {}, this.size = 0;\n}, et.prototype.delete = function(t2) {\n  var e2 = this.has(t2) && delete this.__data__[t2];\n  return this.size -= e2 ? 1 : 0, e2;\n}, et.prototype.get = function(t2) {\n  var e2 = this.__data__;\n  if (Y) {\n    var r2 = e2[t2];\n    return \"__lodash_hash_undefined__\" === r2 ? void 0 : r2;\n  }\n  return Z.call(e2, t2) ? e2[t2] : void 0;\n}, et.prototype.has = function(t2) {\n  var e2 = this.__data__;\n  return Y ? void 0 !== e2[t2] : tt.call(e2, t2);\n}, et.prototype.set = function(t2, e2) {\n  var r2 = this.__data__;\n  return this.size += this.has(t2) ? 0 : 1, r2[t2] = Y && void 0 === e2 ? \"__lodash_hash_undefined__\" : e2, this;\n};\nvar ot = Array.prototype.splice;\nfunction nt(t2) {\n  var e2 = -1, r2 = null == t2 ? 0 : t2.length;\n  for (this.clear(); ++e2 < r2; ) {\n    var o2 = t2[e2];\n    this.set(o2[0], o2[1]);\n  }\n}\nnt.prototype.clear = function() {\n  this.__data__ = [], this.size = 0;\n}, nt.prototype.delete = function(t2) {\n  var e2 = this.__data__, r2 = rt(e2, t2);\n  return !(r2 < 0 || (r2 == e2.length - 1 ? e2.pop() : ot.call(e2, r2, 1), --this.size, 0));\n}, nt.prototype.get = function(t2) {\n  var e2 = this.__data__, r2 = rt(e2, t2);\n  return r2 < 0 ? void 0 : e2[r2][1];\n}, nt.prototype.has = function(t2) {\n  return rt(this.__data__, t2) > -1;\n}, nt.prototype.set = function(t2, e2) {\n  var r2 = this.__data__, o2 = rt(r2, t2);\n  return o2 < 0 ? (++this.size, r2.push([t2, e2])) : r2[o2][1] = e2, this;\n};\nvar at = z(r, \"Map\");\nfunction it(t2, e2) {\n  var r2, o2, n2 = t2.__data__;\n  return (\"string\" == (o2 = typeof (r2 = e2)) || \"number\" == o2 || \"symbol\" == o2 || \"boolean\" == o2 ? \"__proto__\" !== r2 : null === r2) ? n2[\"string\" == typeof e2 ? \"string\" : \"hash\"] : n2.map;\n}\nfunction st(t2) {\n  var e2 = -1, r2 = null == t2 ? 0 : t2.length;\n  for (this.clear(); ++e2 < r2; ) {\n    var o2 = t2[e2];\n    this.set(o2[0], o2[1]);\n  }\n}\nfunction ut(t2) {\n  var e2 = this.__data__ = new nt(t2);\n  this.size = e2.size;\n}\nst.prototype.clear = function() {\n  this.size = 0, this.__data__ = { hash: new et(), map: new (at || nt)(), string: new et() };\n}, st.prototype.delete = function(t2) {\n  var e2 = it(this, t2).delete(t2);\n  return this.size -= e2 ? 1 : 0, e2;\n}, st.prototype.get = function(t2) {\n  return it(this, t2).get(t2);\n}, st.prototype.has = function(t2) {\n  return it(this, t2).has(t2);\n}, st.prototype.set = function(t2, e2) {\n  var r2 = it(this, t2), o2 = r2.size;\n  return r2.set(t2, e2), this.size += r2.size == o2 ? 0 : 1, this;\n}, ut.prototype.clear = function() {\n  this.__data__ = new nt(), this.size = 0;\n}, ut.prototype.delete = function(t2) {\n  var e2 = this.__data__, r2 = e2.delete(t2);\n  return this.size = e2.size, r2;\n}, ut.prototype.get = function(t2) {\n  return this.__data__.get(t2);\n}, ut.prototype.has = function(t2) {\n  return this.__data__.has(t2);\n}, ut.prototype.set = function(t2, e2) {\n  var r2 = this.__data__;\n  if (r2 instanceof nt) {\n    var o2 = r2.__data__;\n    if (!at || o2.length < 199) return o2.push([t2, e2]), this.size = ++r2.size, this;\n    r2 = this.__data__ = new st(o2);\n  }\n  return r2.set(t2, e2), this.size = r2.size, this;\n};\nvar ct = r.Uint8Array;\nexport {\n  at as M,\n  ut as S,\n  ct as U,\n  S as a,\n  Q as b,\n  a as c,\n  st as d,\n  w as e,\n  C as f,\n  z as g,\n  J as h,\n  T as i,\n  x as j,\n  B as k,\n  p as l,\n  X as o,\n  y as t\n};\n//# sourceMappingURL=_Uint8Array-Cf-PTZCw.js.map\n","import { html, LitElement } from 'lit'\nimport { createRef, ref } from 'lit/directives/ref.js'\nimport { ContextProvider, ContextConsumer } from '@lit/context'\nimport '@auroratide/toggle-switch/lib/define.js'\nimport { loggerFactory } from '@/utils/logger.js'\nimport { addToGlobalBib } from '@/utils/bib.js'\nimport { dispatchPublicEvent } from '@/utils/events.js'\nimport { ConsentTokens } from './ConsentTokens.js'\nimport createConsentClient from './consentClient.js'\nimport { consentContext } from './consent-context.js'\nimport '../bib-button/bib-button-close.js'\nimport './bib-consent-consent-dialog.js'\nimport './bib-consent-preferences-dialog.js'\nimport { CONSENT_STATES, EVENT_NAMES, SERVER_MODE, SERVER_REQUEST_DEFAULT_TIMEOUT, SERVER_DEFAULT_URL } from './constants.js'\nimport { c } from '../../../dist/_Uint8Array-Cf-PTZCw.js'\n\nconst debug = loggerFactory('bib-consent', '#cd5300')\n\n/**\n * @typedef {'indeterminate' | 'determinate'} ConsentState\n */\n\n/**\n * The `BibConsent` class is a custom web component that provides a user interface for managing consent preferences.\n *\n * It includes the following functionality:\n * - Fetching and displaying the user's consent preferences from a server\n * - Allowing the user to change their consent preferences\n * - Saving the changed consent preferences to the server\n * - Providing a consent dialog and a preferences dialog for the user to interact with\n *\n * The component can be configured with the following properties:\n * - `serverUrl`: the URL of the server where the consent preferences are stored\n * - `serverRequestTimeout`: the timeout for requests to the server\n * - `[SERVER_MODE.LOCAL]`: a boolean indicating whether the component is running in local mode\n * - `debug`: a boolean indicating whether debug logging should be enabled\n * - `open`: a boolean indicating whether the consent dialog or preferences dialog is currently open\n *\n * The component uses the `@lit/context` library to manage the consent preferences as a shared context, and the `createConsentClient` function to interact with the server.\n * \n * @class BibConsent\n * @extends LitElement\n * @property {string} serverUrl - The URL of the server where the consent preferences are stored.\n * @property {number} serverRequestTimeout - The timeout for requests to the server.\n * @property {boolean} [SERVER_MODE.LOCAL] - A boolean indicating whether the component is running in local mode.\n * @property {boolean} debug - A boolean indicating whether debug logging should be enabled.\n * @property {boolean} open - A boolean indicating whether the consent dialog or preferences dialog is currently open.\n * @property {ConsentState} state - The current state of the BibConsent component, which can be one of the following values:\n *   - `indeterminate`: The user has not yet indicated their consent preferences.\n *   - `determinate`: The user has made their consent preferences.\n * @property {import('./ConsentTokens.js').ConsentTokens} consentTokens - The user's consent tokens.\n * @emits {CustomEvent} EVENT_NAMES.READY - Emitted when the consent client is ready.\n * @emits {CustomEvent} EVENT_NAMES.CHANGE - Emitted when the consent preferences are changed.\n * @emits {CustomEvent} context-request - Emitted when the context is requested.\n * @method connectedCallback - Initializes the component and sets up the necessary state and references.\n * @method close - Closes the current dialog and sets the `open` property to `false`.\n * @method show - Shows the consent dialog.\n * @method showPreferences - Shows the preferences dialog.\n * @method getTokens - Gets the user's consent tokens.\n * @method saveTokens - Saves the user's consent tokens to the server.\n * @method resetTokens - Resets the user's consent tokens to their default values.\n * @method render - Renders the component.\n */\nexport class BibConsent extends LitElement {\n  static properties = {\n    serverUrl: {\n      type: String,\n      attribute: 'server-url'\n    },\n    serverRequestTimeout: {\n      type: Number,\n      attribute: 'server-request-timeout'\n    },\n    [SERVER_MODE.LOCAL]: {\n      type: Boolean\n    },\n    state: {\n      type: String\n    },\n    debug: {\n      type: Boolean,\n      reflect: true\n    },\n    open: {\n      type: Boolean,\n      reflect: true\n    },\n  }\n\n  _consentClient\n  #consentTokens\n  #consentProvider\n  #consentConsumer\n  #state = CONSENT_STATES.INDETERMINATE\n  #consentDialogRef\n  #preferencesDialogRef\n\n  /**\n   * Initializes the `BibConsent` component, setting up the necessary state and references.\n   * \n   * The constructor performs the following tasks:\n   * - Calls the parent class constructor (`super()`)\n   * - Initializes the `open` property to `false`, indicating that no dialog is currently open\n   * - Sets the `currentDialog` property to `null`, as no dialog is currently open\n   * - Creates references to the consent dialog and preferences dialog using `createRef()`\n   * - Creates a `ContextProvider` instance for the consent context, with the component instance as the host and an initial value of `null`\n   * - Creates a `ContextConsumer` instance for the consent context, with the component instance as the host and the `savePreferences` method as the callback\n   */\n  constructor() {\n    super()\n    this.open = false\n    this.currentDialog = null\n    this.#consentDialogRef = createRef()\n    this.#preferencesDialogRef = createRef()\n    this.#consentProvider = new ContextProvider(this, { context: consentContext, initialValue: new ConsentTokens() })\n    this.#consentConsumer = new ContextConsumer(this, { context: consentContext, callback: this.savePreferences })\n  }\n\n  #dispatchPublicEvent(name, detail = null) {\n    dispatchPublicEvent(this, name, { detail })\n  }\n\n  /**\n   * Gets the current state of the BibConsent component.\n   * The state is determined by the user's input. Initially `indeterminate`, it turns `determinate` when the user has indicated their consent preferences.\n   * @readonly\n   * @returns {import('./constants.js').consentStateTypes} The current state of the BibConsent component, which can be one of the following values:\n   * - `indeterminate`: The user has not yet indicated their consent preferences.\n   * - `determinate`: The user has made their consent preferences.\n   */\n  get state() {\n    return this.#state\n  }\n\n  // /**\n  //  * Gets the user's consent tokens.\n  //  * @readonly\n  //  * @returns {import('./ConsentTokens.js').ConsentTokens} The user's consent tokens.\n  //  */\n  // get consentTokens() {\n  //   return this.#consentConsumer.value\n  // }\n\n  /**\n   * Initializes the `BibConsent` component, sets up the necessary state and references, and handles events related to the consent client.\n   * \n   * The `connectedCallback` method performs the following tasks:\n   * - Calls the parent class's `connectedCallback` method\n   * - Sets the `debug` property to `false` if it is not already defined\n   * - Sets the `serverUrl` property to `'https://bib.umontreal.ca/consent/server/'` if it is not already defined\n   * - Sets the `serverRequestTimeout` property to `SERVER_REQUEST_DEFAULT_TIMEOUT` if it is not already defined\n   * - Creates a `ConsentClient` instance and assigns it to the `_consentClient` property\n   * - Adds event listeners for the `EVENT_NAMES.READY` and `EVENT_NAMES.CHANGE` events on the `_consentClient` instance\n   * - Adds an event listener for the `context-request` event on the component's shadow root, which responds with the current tokens\n   */\n  async connectedCallback() {\n    super.connectedCallback()\n    this.debug = this.debug || false\n    this.serverUrl = this.serverUrl || SERVER_DEFAULT_URL\n    this.serverRequestTimeout = this.serverRequestTimeout || SERVER_REQUEST_DEFAULT_TIMEOUT\n\n    this._consentClient = await createConsentClient({ host: this, serverUrl: this.serverUrl, serverRequestTimeout: this.serverRequestTimeout, reflectEvents: true })\n\n    this._consentClient.addEventListener(EVENT_NAMES.READY, event => {\n\n      const { detail: consentData } = event\n\n      if (consentData.getState() === CONSENT_STATES.DETERMINATE) {\n        this.#setValue(consentData)\n      } else {\n        this.#show('consent')\n      }\n\n      this.#dispatchPublicEvent(EVENT_NAMES.READY, consentData.toObject())\n    })\n  }\n\n  #setValue(value) {\n    this.#consentProvider.setValue(value)\n    this.#state = this.#consentProvider.value.getState()\n  }\n\n  #debug() {\n    if (this.debug) {\n      debug(...arguments)\n    }\n  }\n\n  #close(emit = true) {\n    this.open = false\n    this.currentDialog?.close(emit)\n    this.currentDialog = null\n\n    if (emit) {\n      this.#dispatchPublicEvent(EVENT_NAMES.CLOSE)\n    }\n  }\n\n  /**\n   * Closes the current dialog, if any, and sets the `open` property to `false`.\n   */\n  close() {\n    this.#close()\n  }\n\n  #show(panel = 'consent') {\n\n    const validPanels = ['consent', 'preferences']\n\n    if (typeof panel !== 'string' && !validPanels.includes(panel)) {\n      throw new TypeError(`The panel argument must be a string of either values \\`${validPanels.join(` or `)}\\`. You provided \\`${panel}\\``, panel)\n    }\n\n    this.open = true\n\n    if (this.currentDialog) {\n      this.#debug('[#show] this.currentDialog', this.currentDialog)\n      this.currentDialog.close()\n    }\n\n    this.#debug('[show]', this.#consentDialogRef.value)\n    this.#debug('[show]', this.#preferencesDialogRef.value)\n    this.currentDialog = panel === 'consent' ? this.#consentDialogRef.value : this.#preferencesDialogRef.value\n    this.currentDialog.show()\n  }\n\n  /**\n   * Shows the consent dialog.\n   */\n  show() {\n    this.#show('consent')\n  }\n\n  /**\n   * Shows the preferences dialog.\n   */\n  showPreferences() {\n    this.#show('preferences')\n  }\n\n  /**\n   * Retrieves the user's consent tokens from the server.\n   *\n   * @returns {Promise<Object>} - A promise that resolves to the user's consent tokens.\n   */\n  async getTokens() {\n    this.#consentTokens = await this._consentClient.getConsentTokens()\n    return this.#consentTokens.toObject()\n  }\n\n  /**\n   * Saves the user's consent tokens to the server.\n   *\n   * @param {Object} preferences - The user's consent preferences.\n   * @returns {Promise<boolean>} - A promise that resolves to `true` if the preferences were saved successfully, or `false` if there was an error.\n   */\n\n  async saveTokens(tokens) {\n    this.#debug('[save] tokens: ', tokens)\n    const consentTokens = ConsentTokens.from(tokens)\n    try {\n      await this._consentClient.setConsentTokens(consentTokens)\n      this.#setValue(consentTokens)\n      return true\n    } catch (error) {\n      console.error('[savePreferences] error: ', error)\n      throw error\n    }\n  }\n\n  /**\n   * Resets the user's consent preferences to their default values.\n   *\n   * @returns {Promise<Object>} - A promise that resolves to the user's reset consent preferences.\n   */\n  async resetTokens() {\n    await this._consentClient.resetTokens()\n    const tokens = await this._consentClient.getConsentTokens()\n    this.#consentTokens = tokens\n    this.#dispatchPublicEvent(EVENT_NAMES.CHANGE, tokens.toObject())\n    return tokens\n  }\n\n  async #handleChangeEvent(event) {\n    // this.#debug('[#handleChangeEvent]', event)\n    const success = await this.saveTokens(event.detail)\n    // this.#debug('[#handleChangeEvent] success: ', success)\n\n    if (!success) {\n      // TODO: show error message\n      return\n    }\n\n    const tokens = await this.getTokens()\n    this.#dispatchPublicEvent(EVENT_NAMES.CHANGE, tokens)\n    this.#close()\n  }\n\n  #handleCloseEvent(event) {\n    this.#close(false)\n  }\n\n  render() {\n    return html`\n        <bib-consent-consent-dialog @intern:change=\"${this.#handleChangeEvent}\" @intern:show-preferences=\"${() => this.#show('preferences')}\" ${ref(this.#consentDialogRef)} @intern:close=\"${this.#handleCloseEvent}\"></bib-consent-consent-dialog>\n        <bib-consent-preferences-dialog @intern:change=\"${this.#handleChangeEvent}\" ${ref(this.#preferencesDialogRef)} @intern:close=\"${this.#handleCloseEvent}\"></bib-consent-preferences-dialog>\n    `\n  }\n}\n\nif (!window.customElements.get('bib-consent')) {\n  window.customElements.define('bib-consent', BibConsent)\n}\n\naddToGlobalBib('consent', {})"],"names":["value","this","o","s","setValue","t","i","Object","is","updateObservers","constructor","subscriptions","Map","disposer","addCallback","has","set","delete","consumerHost","h","get","clearCallbacks","clear","e$1","Event","super","bubbles","composed","context","e","initialValue","onContextRequest","composedPath","host","stopPropagation","callback","subscribe","onProviderRequest","Set","add","dispatchEvent","attachListeners","addController","addEventListener","hostConnected","global","self","Function","n","Symbol","l","prototype","r","hasOwnProperty","c","toString","a","toStringTag","b","u","t2","t3","e2","call","o2","n2","t4","l2","j","_","f","exec","keys","IE_PROTO","d","v","g","m","RegExp","replace","z","r2","e3","test","E","propertyIsEnumerable","arguments","M","exports","nodeType","R","module","q","Buffer","isBuffer","L","N","V","process","W","require","types","binding","isTypedArray","Uint8Array","debug","loggerFactory","BibConsent","LitElement","__privateAdd","_Y_instances","_consentClient","consentTokens","consentProvider","consentConsumer","state","CONSENT_STATES","INDETERMINATE","consentDialogRef","preferencesDialogRef","open","currentDialog","createRef","ContextProvider","consentContext","ConsentTokens","ContextConsumer","s$1","savePreferences","connectedCallback","serverUrl","SERVER_DEFAULT_URL","serverRequestTimeout","SERVER_REQUEST_DEFAULT_TIMEOUT","createConsentClient","reflectEvents","EVENT_NAMES","READY","event","detail","consentData","getState","DETERMINATE","show","dispatchPublicEvent","toObject","close","showPreferences","getTokens","getConsentTokens","saveTokens","tokens","from","setConsentTokens","error","console","resetTokens","CHANGE","render","html","x","handleChangeEvent","ref","p_fn","WeakSet","i_fn","name","c_fn","l_fn","u_fn","emit","CLOSE","a_fn","panel","validPanels","includes","TypeError","join","h_fn","handleCloseEvent","static","type","String","attribute","Number","SERVER_MODE","LOCAL","Boolean","reflect","window","customElements","define","addToGlobalBib"],"mappings":"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","x_google_ignoreList":[0,1]}