{"version":3,"file":"utils-D8yXit-9.js","sources":["../node_modules/postmessage-promise/build/postmessage-promise.esm.js","../node_modules/boolify-string/node_modules/type-detect/index.js","../node_modules/boolify-string/lib/boolify-string.js","../src/utils/url.js","../src/components/bib-consent/constants.js","../src/components/bib-consent/utils.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\n/* eslint-disable no-lonely-if */\nvar CLIENT_RESPONSE = 'client_response';\nvar SERVER_RESPONSE = 'server_response';\nvar responseMap = {\n  server: {\n    receive: CLIENT_RESPONSE,\n    post: SERVER_RESPONSE\n  },\n  client: {\n    receive: SERVER_RESPONSE,\n    post: CLIENT_RESPONSE\n  }\n};\nvar KEY_METHODS = ['hand-shake', 'wave-hand', CLIENT_RESPONSE, SERVER_RESPONSE];\n/**\n * message channel\n * type: 'server' | 'client'\n */\nvar MessageChannel = /*#__PURE__*/_createClass(function MessageChannel(type, messageProxy, timeout) {\n  var _this = this;\n  _classCallCheck(this, MessageChannel);\n  _defineProperty(this, \"receiveMessage\", function (method, eventId, payload) {\n    if (method === responseMap[_this.type].receive) {\n      if (eventId && _this.messageResponse[eventId]) {\n        var response = _this.messageResponse[eventId];\n        delete _this.messageResponse[eventId];\n        response(payload);\n      }\n    } else {\n      // server postMessage and response\n      if (_this.listener) {\n        var _response = function _response(pload) {\n          _this.messageProxy.request(responseMap[_this.type].post, eventId, pload);\n        };\n        _this.listener(method, payload, _response);\n      } else {\n        console.warn('no message listener: ', method, payload);\n      }\n    }\n  });\n  _defineProperty(this, \"doPost\", function (_ref, method, payload) {\n    var resolve = _ref.resolve,\n      reject = _ref.reject,\n      eventId = _ref.eventId;\n    _this.messageResponse[eventId] = resolve;\n    try {\n      _this.messageProxy.request(method, eventId, payload);\n    } catch (e) {\n      delete _this.messageResponse[eventId];\n      reject();\n      throw e;\n    }\n  });\n  _defineProperty(this, \"listenMessage\", function (listener) {\n    _this.listener = listener;\n  });\n  _defineProperty(this, \"postMessage\", function (method, payload) {\n    if (KEY_METHODS.indexOf(method) >= 0) {\n      return Promise.reject(new Error(\"\".concat(method, \" is a protected key-method.\")));\n    }\n    return new Promise(function (resolve, reject) {\n      if (_this.destroyed) {\n        reject(new Error('message-channel had been destroyed!'));\n        return;\n      }\n      var ctimer = null;\n      var reswrap = function reswrap(value) {\n        clearTimeout(ctimer);\n        resolve(value);\n      };\n      var eventId = Math.random().toString().substr(3, 10);\n      _this.doPost({\n        resolve: reswrap,\n        reject: reject,\n        eventId: eventId\n      }, method, payload);\n      ctimer = setTimeout(function () {\n        if (_this.messageResponse) {\n          delete _this.messageResponse[eventId];\n        }\n        reject(new Error('postMessage timeout'));\n      }, _this.timeout || 20 * 1000);\n    });\n  });\n  _defineProperty(this, \"destroy\", function () {\n    _this.destroyed = true;\n    if (_this.unListen) {\n      _this.unListen();\n      _this.unListen = null;\n    }\n    _this.listener = null;\n    _this.messageResponse = null;\n    if (_this.messageProxy) {\n      _this.messageProxy.destroy();\n      _this.messageProxy = null;\n    }\n  });\n  this.type = type;\n  this.messageProxy = messageProxy;\n  this.listener = null;\n  this.messageResponse = {};\n  this.timeout = timeout;\n  this.unListen = this.messageProxy.listen(this.receiveMessage);\n});\n\n/* eslint-disable no-underscore-dangle */\nvar CLIENT_KEY$1 = 'postmessage-promise_client';\nvar SERVER_KEY = 'postmessage-promise_server';\nvar IDENTITY_KEY$1 = 'identity_key';\nvar identityMap = {\n  server: {\n    key: SERVER_KEY,\n    accept: CLIENT_KEY$1\n  },\n  client: {\n    key: CLIENT_KEY$1,\n    accept: SERVER_KEY\n  }\n};\nvar MessageProxy = /*#__PURE__*/_createClass(function MessageProxy(type, sourceInfo, eventFilter) {\n  var _this2 = this;\n  _classCallCheck(this, MessageProxy);\n  _defineProperty(this, \"listen\", function (fn) {\n    var _this = _this2;\n    var listener = function listener(event) {\n      if (_this.origin !== '*' && event.origin !== _this.origin || event.source !== _this.source || !event.data || event.data[IDENTITY_KEY$1] !== identityMap[_this.type].accept || event.data.channelId !== _this.channelId || !_this.eventFilter(event) || !event.data.method) {\n        return;\n      }\n      var _event$data = event.data,\n        eventId = _event$data.eventId,\n        method = _event$data.method,\n        payload = _event$data.payload;\n      fn(method, eventId, payload);\n    };\n    window.addEventListener('message', listener);\n    return function unListen() {\n      window.removeEventListener('message', listener);\n    };\n  });\n  _defineProperty(this, \"request\", function (method, eventId, payload) {\n    if (!_this2.source || _this2.source.closed) {\n      console.error('source closed.');\n      return;\n    }\n    _this2.source.postMessage(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({}, IDENTITY_KEY$1, identityMap[_this2.type].key), \"channelId\", _this2.channelId), \"eventId\", eventId), \"method\", method), \"payload\", payload), _this2.origin);\n  });\n  _defineProperty(this, \"destroy\", function () {\n    _this2.type = '';\n    _this2.origin = '';\n    _this2.source = null;\n    _this2.channelId = '';\n    _this2.eventFilter = null;\n  });\n  this.type = type;\n  var origin = sourceInfo.origin,\n    source = sourceInfo.source,\n    channelId = sourceInfo.channelId;\n  this.origin = origin;\n  this.source = source;\n  this.channelId = channelId;\n  this.eventFilter = eventFilter;\n});\n\nfunction ownKeys$1(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread$1(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$1(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$1(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction connectServer(sourceInfo, clientProxy, timeout, clientInfo) {\n  return new Promise(function (resolve, reject) {\n    var server = sourceInfo.source,\n      origin = sourceInfo.origin,\n      channelId = sourceInfo.channelId;\n    var SYN = 1;\n    var ACK = 0;\n    var seqnumber = Number(Math.random().toString().substr(3, 10));\n    var timer = null;\n    var startTime = new Date();\n    var unListen = null;\n    function handShake(method, eventId) {\n      var payload = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      if (method === 'hand-shake') {\n        // 判断状态\n        var _ref = payload || {},\n          sSYN = _ref.SYN,\n          sACK = _ref.ACK,\n          sSeq = _ref.seqnumber,\n          acknumber = _ref.acknumber;\n        // console.log('client hand shake', payload);\n        if (sSYN === 1 && sACK === 1 && acknumber === seqnumber + 1) {\n          // this is server acknowledgement\n          clearInterval(timer);\n          if (unListen) {\n            unListen();\n          }\n          clientProxy.request('hand-shake', 'hand-shake-event', {\n            clientInfo: clientInfo,\n            ACK: 1,\n            seqnumber: seqnumber + 1,\n            acknumber: sSeq + 1\n          });\n          resolve({\n            server: server,\n            origin: origin,\n            channelId: channelId,\n            serverInfo: payload.serverInfo,\n            clientInfo: clientInfo\n          });\n        }\n      }\n    }\n    unListen = clientProxy.listen(handShake);\n    var tryConnect = function tryConnect() {\n      if (!server || server.closed) {\n        clearInterval(timer);\n        if (unListen) {\n          unListen();\n        }\n        reject(new Error('server closed.'));\n        throw new Error('server closed.');\n      }\n      if (timeout) {\n        var endTime = new Date();\n        var usedTime = endTime - startTime;\n        if (usedTime > timeout) {\n          clearInterval(timer);\n          if (unListen) {\n            unListen();\n          }\n          reject(new Error('connect timeout.'));\n          throw new Error('connect timeout.');\n        }\n      }\n      clientProxy.request('hand-shake', 'hand-shake-event', {\n        clientInfo: clientInfo,\n        SYN: SYN,\n        ACK: ACK,\n        seqnumber: seqnumber\n      });\n    };\n    timer = setInterval(tryConnect, 100);\n  });\n}\n/**\n * create a message channel based on the channelId.\n * @param {*} clientInfo\n */\nfunction createChannel$1(serverProps, clientProxy, timeout) {\n  var server = serverProps.server,\n    _serverProps$serverIn = serverProps.serverInfo,\n    serverInfo = _serverProps$serverIn === void 0 ? {} : _serverProps$serverIn,\n    channelId = serverProps.channelId;\n  var messageChannel = new MessageChannel('client', clientProxy, timeout);\n  var destroy = function destroy() {\n    if (messageChannel) {\n      messageChannel.destroy();\n      messageChannel = null;\n    }\n    if (serverProps.destroy) {\n      serverProps.destroy();\n    }\n  };\n  // daemon\n  var watcher = null;\n  function watch() {\n    if (!server || server.closed) {\n      console.info('server closed.');\n      clearInterval(watcher);\n      destroy();\n    }\n  }\n  watcher = setInterval(watch, 2000);\n  return {\n    run: function run(resolve) {\n      resolve({\n        channelId: channelId,\n        serverInfo: serverInfo,\n        postMessage: function postMessage() {\n          if (messageChannel) {\n            var _messageChannel;\n            return (_messageChannel = messageChannel).postMessage.apply(_messageChannel, arguments);\n          }\n          return Promise.reject();\n        },\n        listenMessage: function listenMessage() {\n          if (messageChannel) {\n            var _messageChannel2;\n            (_messageChannel2 = messageChannel).listenMessage.apply(_messageChannel2, arguments);\n          }\n        },\n        destroy: destroy\n      });\n    }\n  };\n}\n\n/**\n * connect with server and create message channel\n * @param {*} serverObject\n * @param {*} options : { eventFilter, timeout } filter post messages\n */\nfunction callServer(serverObject) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (!serverObject) throw new Error('serverObject is null');\n  var server = serverObject.server,\n    origin = serverObject.origin;\n  var _options$eventFilter = options.eventFilter,\n    eventFilter = _options$eventFilter === void 0 ? function () {\n      return true;\n    } : _options$eventFilter,\n    _options$timeout = options.timeout,\n    timeout = _options$timeout === void 0 ? 20 * 1000 : _options$timeout,\n    _options$clientInfo = options.clientInfo,\n    clientInfo = _options$clientInfo === void 0 ? {} : _options$clientInfo,\n    onDestroy = options.onDestroy;\n  var channelId = Math.random().toString().substr(3, 10);\n  var sourceInfo = {\n    source: server,\n    origin: origin,\n    channelId: channelId\n  };\n  return new Promise(function (resolve, reject) {\n    if (!server || server.closed) {\n      reject(new Error('server closed'));\n      return;\n    }\n    var clientProxy = new MessageProxy('client', sourceInfo, eventFilter);\n    connectServer(sourceInfo, clientProxy, timeout, clientInfo).then(function (sProps) {\n      var serverProps = _objectSpread$1(_objectSpread$1({}, sProps), {}, {\n        destroy: function destroy() {\n          clientProxy = null;\n          if (onDestroy) {\n            onDestroy(sProps.serverInfo, sProps);\n          }\n        }\n      });\n      createChannel$1(serverProps, clientProxy, timeout).run(resolve);\n    })[\"catch\"](function (e) {\n      reject(e);\n    });\n  });\n}\n\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nvar CLIENT_KEY = 'postmessage-promise_client';\nvar IDENTITY_KEY = 'identity_key';\nvar TCP_TIMEOUT_INIT = 1000; // RFC6298 2.1 initial RTO value\nvar TCP_SYNACK_RETRIES = 5;\nfunction connectClient(eventFilter, serverInfo) {\n  return new Promise(function (resolve) {\n    var waitingType = 'syn'; // ack // finish\n    var SYN = 1;\n    var ACK = 1;\n    var seqnumber = Number(Math.random().toString().substr(3, 10));\n    var cSeqnumber = -1;\n    var timer = null;\n    var retries = TCP_SYNACK_RETRIES;\n    function handShake(event) {\n      if (!event.data || event.data[IDENTITY_KEY] !== CLIENT_KEY || !event.data.channelId || !event.data.method || event.data.method !== 'hand-shake' || !eventFilter(event)) {\n        return;\n      }\n      // 判断状态\n      var _ref = event.data.payload || {},\n        cSYN = _ref.SYN,\n        cACK = _ref.ACK,\n        cSeq = _ref.seqnumber,\n        cAcknumber = _ref.acknumber;\n      // console.log('server hand shake', event.data, waitingType, retries);\n      if (cSYN === 1 && cACK === 0) {\n        if (waitingType !== 'syn') {\n          return; // this is a syn timeout request\n        }\n        cSeqnumber = cSeq;\n        // client synchronous\n        waitingType = 'ack';\n        var fn = function fn() {\n          if (!event.source || event.source.closed) {\n            console.info('client closed and reset to listening.');\n            waitingType = 'syn';\n            clearTimeout(timer);\n            timer = null;\n            retries = TCP_SYNACK_RETRIES;\n            seqnumber = Number(Math.random().toString().substr(3, 10));\n            cSeqnumber = -1;\n            return false;\n          }\n          try {\n            event.source.postMessage(_defineProperty(_defineProperty(_defineProperty(_defineProperty({}, IDENTITY_KEY, 'postmessage-promise_server'), \"channelId\", event.data.channelId), \"method\", 'hand-shake'), \"payload\", {\n              serverInfo: serverInfo,\n              acknumber: cSeq + 1,\n              SYN: SYN,\n              ACK: ACK,\n              seqnumber: seqnumber\n            }), event.origin);\n          } catch (e) {\n            console.error(e);\n            return true;\n          }\n          return true;\n        };\n        var tryAck = fn();\n        if (!tryAck) return;\n        var retryFn = function retryFn() {\n          if (retries > 0) {\n            // waitingType = 'syn';\n            if (waitingType === 'ack') {\n              // eslint-disable-next-line operator-assignment\n              retries = retries - 1;\n              if (fn()) {\n                timer = setTimeout(retryFn, TCP_TIMEOUT_INIT);\n              }\n            }\n          } else {\n            // reset to a new listening\n            console.info('server three-way hand shake timeout and reset to listening.');\n            waitingType = 'syn';\n            clearTimeout(timer);\n            timer = null;\n            retries = TCP_SYNACK_RETRIES;\n            seqnumber = Number(Math.random().toString().substr(3, 10));\n            cSeqnumber = -1;\n          }\n        };\n        // TCP_TIMEOUT_INIT: waiting for the third hand shake until timeout.\n        if (!timer) {\n          timer = setTimeout(retryFn, TCP_TIMEOUT_INIT);\n        }\n      } else if (waitingType === 'ack') {\n        if (cACK === 1 && cSeq === cSeqnumber + 1 && cAcknumber === seqnumber + 1) {\n          // waiting for the third hand shake.\n          waitingType = 'finish';\n          clearTimeout(timer);\n          timer = null;\n          // client acknowledgement\n          window.removeEventListener('message', handShake);\n          var _event$data$payload = event.data.payload,\n            payload = _event$data$payload === void 0 ? {} : _event$data$payload;\n          resolve({\n            client: event.source,\n            origin: event.origin,\n            channelId: event.data.channelId,\n            serverInfo: serverInfo,\n            clientInfo: payload.clientInfo\n          });\n        }\n      } else ;\n    }\n    window.addEventListener('message', handShake);\n  });\n}\n/**\n * create a message channel based on the channelId.\n * @param {*} clientInfo\n */\nfunction createChannel(clientProps, eventFilter, timeout) {\n  var origin = clientProps.origin,\n    client = clientProps.client,\n    channelId = clientProps.channelId,\n    _clientProps$clientIn = clientProps.clientInfo,\n    clientInfo = _clientProps$clientIn === void 0 ? {} : _clientProps$clientIn;\n  var sourceInfo = {\n    origin: origin,\n    source: client,\n    channelId: channelId\n  };\n  var serverProxy = new MessageProxy('server', sourceInfo, eventFilter);\n  var messageChannel = new MessageChannel('server', serverProxy, timeout);\n  var destroy = function destroy() {\n    if (messageChannel) {\n      messageChannel.destroy();\n      messageChannel = null;\n    }\n    serverProxy = null;\n    if (clientProps.destroy) {\n      clientProps.destroy();\n    }\n  };\n  // daemon\n  var watcher = null;\n  function watch() {\n    if (!client || client.closed) {\n      console.info('client closed.');\n      clearInterval(watcher);\n      destroy();\n    }\n  }\n  watcher = setInterval(watch, 2000);\n  return {\n    run: function run(resolve) {\n      resolve({\n        channelId: channelId,\n        clientInfo: clientInfo,\n        postMessage: function postMessage() {\n          if (messageChannel) {\n            var _messageChannel;\n            return (_messageChannel = messageChannel).postMessage.apply(_messageChannel, arguments);\n          }\n          return Promise.reject();\n        },\n        listenMessage: function listenMessage() {\n          if (messageChannel) {\n            var _messageChannel2;\n            (_messageChannel2 = messageChannel).listenMessage.apply(_messageChannel2, arguments);\n          }\n        },\n        destroy: destroy\n      });\n    }\n  };\n}\n\n/**\n * start a server listening, each server listening can only connect with one client.\n * @param {*} options: { eventFilter, timeout } filter post messages\n */\nfunction startListening() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var _options$eventFilter = options.eventFilter,\n    eventFilter = _options$eventFilter === void 0 ? function () {\n      return true;\n    } : _options$eventFilter,\n    _options$timeout = options.timeout,\n    timeout = _options$timeout === void 0 ? 20 * 1000 : _options$timeout,\n    _options$serverInfo = options.serverInfo,\n    serverInfo = _options$serverInfo === void 0 ? {} : _options$serverInfo,\n    onDestroy = options.onDestroy;\n  return new Promise(function (resolve) {\n    connectClient(eventFilter, serverInfo).then(function (cProps) {\n      var clientProps = _objectSpread(_objectSpread({}, cProps), {}, {\n        destroy: function destroy() {\n          if (onDestroy) {\n            onDestroy(cProps.clientInfo, cProps);\n          }\n        }\n      });\n      createChannel(clientProps, eventFilter, timeout).run(resolve);\n    });\n  });\n}\n\n/**\n * Takes a URL and returns the origin. from dollarshaveclub/postmate\n * @param  {String} url The full URL being requested\n * @return {String}     The URLs origin\n */\nfunction resolveOrigin(url) {\n  var a = document.createElement('a');\n  a.href = url;\n  var protocol = a.protocol.length > 4 ? a.protocol : window.location.protocol;\n  // eslint-disable-next-line no-nested-ternary\n  var host = a.host.length ? a.port === '80' || a.port === '443' ? a.hostname : a.host : window.location.host;\n  return a.origin || \"\".concat(protocol, \"//\").concat(host);\n}\nfunction getIframeServer(container, targetUrl, name) {\n  var classListArray = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];\n  var root = typeof container !== 'undefined' ? container : document.body;\n  var origin = resolveOrigin(targetUrl);\n  var frame = document.createElement('iframe');\n  frame.name = name || '';\n  // eslint-disable-next-line prefer-spread\n  frame.classList.add.apply(frame.classList, classListArray);\n  root.appendChild(frame);\n  frame.src = targetUrl;\n  var iframeWindow = frame.contentWindow || frame.contentDocument.parentWindow;\n  return {\n    server: iframeWindow,\n    origin: origin,\n    frame: frame\n    // destroy: () => { if (frame) { frame.parentNode.removeChild(frame); } }\n  };\n}\nfunction getOpenedServer(targetUrl) {\n  var _window;\n  // window.opener.origin inaccessible when cross-origin\n  var origin = resolveOrigin(targetUrl);\n  for (var _len = arguments.length, opts = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    opts[_key - 1] = arguments[_key];\n  }\n  var openedWindow = (_window = window).open.apply(_window, [targetUrl].concat(opts));\n  return {\n    server: openedWindow,\n    origin: origin\n    // destroy: () => { if (openedWindow && openedWindow.close) { openedWindow.close(); } },\n  };\n}\nvar utils = {\n  resolveOrigin: resolveOrigin,\n  getIframeServer: getIframeServer,\n  getOpenedServer: getOpenedServer\n};\n\nvar index = {\n  callServer: callServer,\n  startListening: startListening,\n  utils: utils\n};\n\nexport { callServer, index as default, startListening, utils };\n","module.exports = require('./lib/type');\n","/*\n * boolify-string\n * https://github.com/sanemat/node-boolify-string\n *\n * Copyright (c) 2014 sanemat\n * Licensed under the MIT license.\n */\n\n'use strict';\nvar type = require('type-detect');\n\nmodule.exports = function(obj){\n  if (type(obj) !== 'string') {\n    return !!obj;\n  }\n  var value = obj.toLowerCase();\n  var bool;\n  switch (value){\n    case 'false':\n    case '0':\n    case 'undefined':\n    case 'null':\n    case '':\n    case 'n':\n    case 'no':\n    case 'off':\n      bool = false;\n      break;\n    default:\n      bool = true;\n      break;\n  }\n  return bool;\n};\n","import boolifyString from 'boolify-string'\n\nexport function hasBooleanParam(url, param) {\n  url = typeof url === 'string' ? new URL(url, location) : url\n\n  const booleanString = url.searchParams.get(param)\n\n  if (booleanString === null) {\n    return false\n  }\n\n  if (booleanString === '') {\n    return true\n  }\n\n  return boolifyString(booleanString)\n}\n\nexport function stringIsUrl(string) {\n  try {\n    new URL(string, location)\n    return true\n  } catch {\n    return false\n  }\n}\n\n// This is a modified version of https://www.npmjs.com/package/escape-string-regexp\nexport function escapeStringRegexp(string) {\n  if (typeof string !== 'string') {\n    throw new TypeError('Expected a string')\n  }\n\n  // Escape characters with special meaning either inside or outside character sets.\n  // Use a simple backslash escape when it’s always valid, and a `\\xnn` escape when the simpler form would be disallowed by Unicode patterns’ stricter grammar.\n  return string\n    .replace(/[|\\\\{}()[\\]^$+?.]/g, '\\\\$&')\n    .replace(/-/g, '\\\\x2d')\n}","import { name } from '../../../package.json'\nimport { createPrefixedEventName } from './utils.js'\n\nconst eventName = createPrefixedEventName('consent')\n\nexport const DB_NAME = `${name}/consent`\nexport const DB_VERSION = 1\nexport const DB_STORE_NAME = 'consent'\n\nexport const EVENT_NAMES = {\n  CONSENT: eventName('consent'),\n  READY: eventName('ready'),\n  UPDATE: eventName('update'),\n}\nexport const PREFIX = 'bib-consent'\nexport const SERVER_MODE = {\n  LOCAL: 'local',\n  REMOTE: 'remote'\n}\nexport const SERVER_REQUEST_DEFAULT_TIMEOUT = 500\nexport const DEFAULT_PREFERENCES = {\n  performanceCookies: null,\n  functionalityCookies: null,\n  adsCookies: null\n}","import { utils as postmessageUtils } from 'postmessage-promise'\nimport { hasBooleanParam } from '@/utils/url.js'\nimport { PREFIX, SERVER_MODE, SERVER_REQUEST_DEFAULT_TIMEOUT } from './constants.js'\n\n/**\n * Creates a prefixed event name for the BIB consent module.\n * @param {string} prefix - The prefix to use for the event name.\n * @returns {function(string): string} - A function that takes an event name and returns the prefixed event name.\n */\nexport function createPrefixedEventName(prefix) {\n  return function (eventName) {\n    return `bib:${prefix}:${eventName}`\n  }\n}\n\n/**\n * Creates a prefixed key name for the BIB consent module.\n * @param {string} key - The key to be prefixed.\n * @returns {string} - The prefixed key name.\n */\nexport function getKeyName(key) {\n  return `${PREFIX}-${key}`\n}\n\n/**\n * Gets an iframe server for a given target URL.\n * @param {HTMLElement} [container=document.body] - The container element for the iframe.\n * @param {string} targetUrl - The target URL for the iframe.\n * @returns {object} - An object containing the iframe server, origin, and the iframe element.\n */\nexport function getIframeServer(\n  container,\n  targetUrl,\n) {\n  const root = typeof container !== 'undefined' ? container : document.body\n  const origin = postmessageUtils.resolveOrigin(targetUrl)\n  const iframeId = getKeyName('iframe')\n  let iframe\n  if (document.querySelector(`#${iframeId}`)) {\n    iframe = document.querySelector(`#${iframeId}`)\n  } else {\n    iframe = document.createElement('iframe')\n    iframe.id = iframeId\n\n    const isDebugOn = hasBooleanParam(targetUrl, 'debug')\n\n    if (!isDebugOn) {\n      iframe.ariaHidden = true\n      iframe.tabIndex = -1\n      iframe.hidden = true\n      iframe.style.setProperty('display', 'none')\n    } else {\n      iframe.style.cssText = 'width: 100%; height: 100%; border: 0;'\n    }\n\n    root.appendChild(iframe)\n    iframe.src = targetUrl\n  }\n\n  const iframeWindow = iframe.contentWindow || iframe.contentDocument.parentWindow\n\n  return {\n    server: iframeWindow,\n    origin,\n    iframe,\n  }\n}\n\n/**\n * Checks the server mode for a given client.\n * \n * If the client has no server URL, the function returns `SERVER_MODE.LOCAL`.\n * Otherwise, it checks if the server page exists by making a fetch request to the server URL.\n * If the request is successful (response.ok), the function returns `SERVER_MODE.REMOTE`.\n * If the request times out or fails, the function throws an error with the appropriate message.\n *\n * @param {object} client - The client object containing the server URL.\n * @param {number} [timeout=SERVER_REQUEST_DEFAULT_TIMEOUT] - The timeout in milliseconds for the server request.\n * @returns {string} - The server mode, either `SERVER_MODE.LOCAL` or `SERVER_MODE.REMOTE`.\n * @throws {Error} - If the server page cannot be located or the request fails.\n */\nexport async function getServerMode(client) {\n\n  const serverUrl = client.serverUrl\n  const timeout = client.serverRequestTimeout || SERVER_REQUEST_DEFAULT_TIMEOUT\n\n  if (!serverUrl) {\n    return SERVER_MODE.LOCAL\n  }\n\n  // Check if server page exists\n  const controller = new AbortController()\n  let response\n\n  try {\n    const timeoutHandle = setTimeout(() => {\n      console.warn(`Request timed out after ${timeout}ms. Aborting request...`)\n      controller.abort()\n    }, timeout)\n    response = await fetch(serverUrl, { signal: controller.signal })\n    clearTimeout(timeoutHandle)\n\n    if (response.ok) {\n      return SERVER_MODE.REMOTE\n    }\n  } catch (error) {\n\n    if (controller.signal.aborted) {\n      throw new Error(`Unable to locate server page. The request timed out after ${timeout}ms. url: ${serverUrl.href}`)\n    }\n\n    throw new Error(`Unable to locate server page. Request url: ${serverUrl.href}.`, error)\n  }\n\n  throw new Error(`Unable to locate server page. The request failed with status code ${response.status}. url: ${serverUrl.href}`)\n}"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_createClass","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","CLIENT_RESPONSE","SERVER_RESPONSE","responseMap","server","receive","post","client","KEY_METHODS","MessageChannel","type","messageProxy","timeout","_this","this","method","eventId","payload","messageResponse","response","listener","pload","request","console","warn","_ref","resolve","reject","e","indexOf","Promise","Error","concat","destroyed","ctimer","Math","random","toString","substr","doPost","clearTimeout","setTimeout","unListen","destroy","listen","receiveMessage","CLIENT_KEY$1","SERVER_KEY","IDENTITY_KEY$1","identityMap","accept","MessageProxy","sourceInfo","eventFilter","_this2","fn","event","origin","source","data","channelId","_event$data","window","addEventListener","removeEventListener","closed","postMessage","error","ownKeys$1","r","t","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","push","apply","_objectSpread$1","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","callServer","serverObject","options","_options$eventFilter","_options$timeout","_options$clientInfo","clientInfo","onDestroy","clientProxy","seqnumber","Number","timer","startTime","Date","sSYN","SYN","sACK","ACK","sSeq","acknumber","clearInterval","serverInfo","setInterval","then","sProps","serverProps","_serverProps$serverIn","messageChannel","watcher","info","run","_messageChannel","listenMessage","_messageChannel2","ownKeys","_objectSpread","IDENTITY_KEY","startListening","_options$serverInfo","waitingType","cSeqnumber","retries","handShake","cSYN","cACK","cSeq","cAcknumber","retryFn","_event$data$payload","cProps","clientProps","_clientProps$clientIn","serverProxy","resolveOrigin","url","a","document","createElement","href","protocol","location","host","port","hostname","utils","getIframeServer","container","targetUrl","name","classListArray","root","body","frame","classList","add","appendChild","src","contentWindow","contentDocument","parentWindow","getOpenedServer","_window","_len","opts","Array","_key","open","require$$0","bool","toLowerCase","stringIsUrl","string","URL","escapeStringRegexp","replace","eventName","createPrefixedEventName","DB_NAME","DB_VERSION","DB_STORE_NAME","EVENT_NAMES","CONSENT","READY","UPDATE","PREFIX","SERVER_MODE","LOCAL","REMOTE","SERVER_REQUEST_DEFAULT_TIMEOUT","DEFAULT_PREFERENCES","performanceCookies","functionalityCookies","adsCookies","prefix","getKeyName","postmessageUtils","iframeId","iframe","querySelector","id","param","booleanString","searchParams","get","boolifyString","style","cssText","ariaHidden","tabIndex","hidden","setProperty","s","async","getServerMode","serverUrl","serverRequestTimeout","controller","AbortController","timeoutHandle","abort","fetch","signal","ok","aborted","status"],"mappings":"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","x_google_ignoreList":[0,1,2]}