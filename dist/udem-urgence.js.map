{"version":3,"file":"udem-urgence.js","sources":["../src/components/udem-urgence/udem-urgence.js","../src/constants.js"],"sourcesContent":["import { Task } from '@lit/task'\r\nimport { LitElement, html, css, unsafeCSS } from 'lit'\r\nimport { SPACE_KEY, ENTER_KEY } from '../../constants'\r\nimport styles from './udem-urgence.scss?inline'\r\n\r\n/**\r\n * Un message d'urgence du BCRP\r\n */\r\nexport class UdeMUrgence extends LitElement {\r\n  static properties = {\r\n    service: {\r\n      type: String\r\n    },\r\n    big: {\r\n      type: Boolean,\r\n    },\r\n    href: {\r\n      type: String,\r\n      attribute: false\r\n    }\r\n  }\r\n\r\n  static styles = [\r\n    css`${unsafeCSS(styles)}`\r\n  ]\r\n\r\n  constructor() {\r\n    super()\r\n\r\n    this.big = false\r\n    this.service = 'https://urgence.umontreal.ca/urgence-udem.json'\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback()\r\n    this.render()\r\n  }\r\n\r\n  #urgenceTask = new Task(this, {\r\n    task: async ([service], { signal }) => {\r\n      const url = new URL(service)\r\n      const response = await fetch(url, {\r\n        headers: {\r\n          \"Accept\": \"application/json\"\r\n        },\r\n        signal\r\n      })\r\n      if (!response.ok) {\r\n        throw new Error(response.status)\r\n      }\r\n      return response.json()\r\n    },\r\n    args: () => [this.service]\r\n  })\r\n\r\n  #onTitleClick(event) {\r\n    event.preventDefault()\r\n    event.stopPropagation()\r\n  }\r\n\r\n  #onActivate(event) {\r\n    const isKeyboardActivateEvent = event.key === SPACE_KEY || event.key === ENTER_KEY\r\n\r\n    if (isKeyboardActivateEvent || event.type === 'click') {\r\n      window.open(this.href, '_blank')\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return this.#urgenceTask.render({\r\n      pending: () => null,\r\n      complete: ({ bannerType, date, fullDay, headerLink, hour, title, url }) => {\r\n        this.href = headerLink ?? url\r\n\r\n        if (bannerType) {\r\n          this.big = bannerType === 'large'\r\n        }\r\n\r\n        return title && html`\r\n          <aside class=\"wrapper${this.big ? ' big' : ''}\" tabindex=\"0\" @click=\"${this.#onActivate}\" @keyup=\"${this.#onActivate}\">\r\n            <div class=\"container\">\r\n              <div class=\"content\">\r\n                <a class=\"title\" href=\"${this.href}\" @click=\"${this.#onTitleClick}\" tabindex=\"-1\">\r\n                  <div>${title}</div>\r\n                </a>\r\n                <time datetime=\"${date}\" class=\"datetime\">\r\n                  <span class=\"hour\">${hour}</span>\r\n                  <span> | </span>\r\n                  <span classid=\"date\">${fullDay}</span>\r\n                </time>\r\n              </div>\r\n            </div>\r\n          </aside>\r\n      `},\r\n\r\n    })\r\n  }\r\n}\r\n\r\nif (!window.customElements.get('udem-urgence')) {\r\n  window.customElements.define('udem-urgence', UdeMUrgence)\r\n}","export const ENTER_KEY = 'Enter'\r\nexport const SPACE_KEY = ' '\r\n"],"names":["UdeMUrgence","LitElement","static","super","this","urgenceTask","Task","task","async","service","signal","url","URL","response","fetch","headers","Accept","ok","Error","status","json","args","big","connectedCallback","render","pending","complete","bannerType","date","fullDay","headerLink","hour","title","href","html","window","onTitleClick","event","preventDefault","stopPropagation","onActivate","key","type","open","String","Boolean","attribute","css","unsafeCSS","customElements","get","define"],"mappings":";;;;;;;;;;;;;AAQO,MAAMA,UAAoBC,EAC/BC;AAAAA,EAiBA;AACEC,UAEAC;AArBG;AA8BLC,2BAAe,IAAIC,EAAKF,MAAM,EAC5BG,MAAMC,QAAQC,EAAYC,GAAAA,EAAAA,QAAAA,GAAAA,MAAAA;AACxB,YAAMC,KAAM,IAAIC,IAAIH,EACdI,GAAAA,KAAAA,MAAiBC,MAAMH,IAAK,EAChCI,SAAS,EACPC,QAAU,mBAEZN,GAAAA,QAAAA,GAAAA,CAAAA;AAEF,WAAKG,GAASI,GACZ,OAAM,IAAIC,MAAML,GAASM,MAAAA;AAE3B,aAAON,GAASO,KAAAA;AAAAA,IAAM,GAExBC,MAAM,MAAM,CAACjB,KAAKK;AAvBlBL,SAAKkB,aACLlB,KAAKK,UAAU;AAAA,EAChB;AAAA,EAED,oBAAAc;AACEpB,UAAMoB,kBACNnB,GAAAA,KAAKoB;EACN;AAAA,EAgCD,SACE;AAAA,WAAOpB,mBAAKC,IAAamB,OAAO,EAC9BC,SAAS,MAAM,MACfC,UAAU,GAAGC,YAAYC,IAAAA,MAAAA,IAAMC,SAASC,IAAAA,YAAAA,IAAYC,UAAMC,OAAOrB,GAAAA,KAAAA,EAAAA,OAC/DP,KAAK6B,OAAOH,MAAcnB,GAEtBgB,OACFvB,KAAKkB,MAAqB,YAAfK,KAGNK,KAASE,yBACS9B,KAAKkB,MAAM,SAAS,EAA4BlB,0BAAAA,sBAAAA,mBAA6BA,aAAAA,sBAAAA,2FAGrEA,KAAK6B,IAAAA,aAAiB7B,yCACtC4B,wBAAAA,CAAAA,6BAESJ,2CACKG,EAEEF,+CAAAA,EAAAA,sCAAAA,CAAAA;AAAAA,EAQtC;AAGEM;AA7DH9B;AA9BK;AA+CL,OAAA+B,SAAcC,IACZA;AAAAA,EAAAA,GAAMC,kBACND,GAAME,gBAAAA;AACP;AAED,OAAAC,SAAYH,IC3DW;AAAA,GAAA,QD4DWA,GAAMI,OC7DjB,YD6DsCJ,GAAMI,OAEnB,YAAfJ,GAAMK,SACnCP,OAAOQ,KAAKvC,KAAK6B,MAAM,QAE1B;AAAA;AAzDD/B,cADWF,GACXE,cAAoB,EAClBO,SAAS,EACPiC,MAAME,OAERtB,GAAAA,KAAK,EACHoB,MAAMG,QAAAA,GAERZ,MAAM,EACJS,MAAME,QACNE,WAAAA;AAIJ5C,cAdWF,GAcK,UAAA,CACd+C,IAAMC,ygCAGR,CAAA,EAAA;AAyEGb,OAAOc,eAAeC,IAAI,cAAA,KAC7Bf,OAAOc,eAAeE,OAAO,gBAAgBnD;"}