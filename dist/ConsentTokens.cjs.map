{"version":3,"file":"ConsentTokens.cjs","sources":["../node_modules/lodash-es/isBoolean.js","../src/components/bib-consent/ConsentTokens.js"],"sourcesContent":["import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]';\n\n/**\n * Checks if `value` is classified as a boolean primitive or object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a boolean, else `false`.\n * @example\n *\n * _.isBoolean(false);\n * // => true\n *\n * _.isBoolean(null);\n * // => false\n */\nfunction isBoolean(value) {\n  return value === true || value === false ||\n    (isObjectLike(value) && baseGetTag(value) == boolTag);\n}\n\nexport default isBoolean;\n","import { isBoolean, isObject } from 'lodash-es'\r\nimport { DEFAULT_PREFERENCES, CONSENT_STATES } from './constants.js'\r\n\r\nconst keys = Object.keys(DEFAULT_PREFERENCES)\r\n\r\nfunction throwOnInvalidValue(value, { key, acceptNull = false } = {}) {\r\n  if (\r\n    !isBoolean(value)\r\n    && !['granted', 'denied'].includes(value)\r\n    &&\r\n    (!acceptNull && value === null)\r\n  ) {\r\n    const message = `Invalid value${key ? ` for field \\`${key}\\`` : ''}: ${value}. Must be either boolean or one of 'granted' or 'denied'.`\r\n    throw new TypeError(message)\r\n  }\r\n}\r\n\r\nfunction throwOnInvalidKey(key) {\r\n  if (!keys.includes(key)) {\r\n    const message = `Invalid key: ${key}. Must be one of ${keys.reduce((str, key, i) => i === keys.length ? `${str} or ${key}` : `${str}, ${key}`)}.`\r\n    throw new TypeError(message)\r\n  }\r\n}\r\n\r\n/**\r\n * @typedef {(ConsentTokens|import('./constants.js').ConsentValues)} ConsentTokensOrTokens\r\n */\r\n\r\n/**\r\n * Represents a set of consent tokens that can be used to track user consent preferences.\r\n *\r\n * The `ConsentTokens` class provides a way to manage and interact with consent tokens, which are used to track a user's preferences for various types of data processing, such as analytics, functionality, and advertising.\r\n *\r\n * The class provides methods for setting and retrieving individual consent tokens, as well as methods for setting all consent tokens at once and resetting the consent state. It also provides a method for generating a consent state object that can be used for integrating with third-party tools, such as Google Tag Manager.\r\n *\r\n * The class uses a set of default preferences defined in the `DEFAULT_PREFERENCES` constant, and provides validation to ensure that consent token values are valid.\r\n */\r\nexport class ConsentTokens {\r\n\r\n  /**\r\n   * Creates a new `ConsentTokens` instance from the provided `tokens` object or value.\r\n   *\r\n   * If `tokens` is an object, the method iterates over its keys and sets the corresponding consent token values.\r\n   *\r\n   * If `tokens` is not an object, the method sets all consent token values to the provided `tokens` value.\r\n   *\r\n   * The method returns the newly created `ConsentTokens` instance.\r\n   *\r\n   * @param {ConsentTokensOrTokens} tokens - An object or value representing the consent token values to initialize the `ConsentTokens` instance with.\r\n   * @returns {ConsentTokens} - A new `ConsentTokens` instance initialized with the provided `tokens`.\r\n   */\r\n  static from(tokens) {\r\n    const consentTokens = new ConsentTokens()\r\n\r\n    if (typeof tokens !== 'undefined') {\r\n      if (isObject(tokens)) {\r\n        Object.keys(tokens).forEach(key => {\r\n          consentTokens.#setToken(key, tokens[key], true)\r\n        })\r\n      } else {\r\n        consentTokens.#setAll(tokens, true)\r\n      }\r\n    }\r\n\r\n    return consentTokens\r\n  }\r\n\r\n  #tokens = {\r\n    ...DEFAULT_PREFERENCES\r\n  }\r\n\r\n  #setToken(key, value, acceptNull = false) {\r\n    throwOnInvalidKey(key)\r\n    throwOnInvalidValue(value, { key, acceptNull })\r\n\r\n    this.#tokens[key] = isBoolean(value) ? value ? 'granted' : 'denied' : value\r\n  }\r\n\r\n  #setAll(value, acceptNull = false) {\r\n\r\n    throwOnInvalidValue(value, { acceptNull })\r\n\r\n    if (typeof value !== 'string') {\r\n      value = value ? 'granted' : 'denied'\r\n    }\r\n\r\n    Object.keys(this.#tokens).forEach(key => this.#tokens[key] = value)\r\n  }\r\n\r\n  constructor(tokens) {\r\n\r\n    // Defining getters and setters on the constructor function\r\n    // so they are enumerables\r\n\r\n    Object.defineProperties(this, {\r\n      analytics_consent: {\r\n        enumerable: true,\r\n        get: () => this.#tokens.analytics_consent,\r\n        set: value => this.#setToken('analytics_consent', value)\r\n      },\r\n      functionality_consent: {\r\n        enumerable: true,\r\n        get: () => this.#tokens.functionality_consent,\r\n        set: value => this.#setToken('functionality_consent', value)\r\n      },\r\n      ad_consent: {\r\n        enumerable: true,\r\n        get: () => this.#tokens.ad_consent,\r\n        set: value => this.#setToken('ad_consent', value)\r\n      }\r\n    })\r\n\r\n    if (typeof tokens !== 'undefined') {\r\n      if (isObject(tokens)) {\r\n        Object.keys(DEFAULT_PREFERENCES).forEach(key => {\r\n          if (Reflect.has(tokens, key)) {\r\n            this.#setToken(key, tokens[key])\r\n          }\r\n        })\r\n\r\n      } else {\r\n\r\n        this.#setAll(tokens)\r\n      }\r\n    }\r\n  }\r\n\r\n  isGranted(key) {\r\n    throwOnInvalidKey(key)\r\n\r\n    return this.#tokens[key] === CONSENT_STATES.GRANTED\r\n  }\r\n\r\n  isDenied(key) {\r\n    throwOnInvalidKey(key)\r\n\r\n    return this.#tokens[key] === CONSENT_STATES.DENIED\r\n  }\r\n\r\n  getState() {\r\n    return Object.values(this.#tokens).every(value => value !== null) ? CONSENT_STATES.DETERMINATE : CONSENT_STATES.INDETERMINATE\r\n  }\r\n\r\n  setAll(data) {\r\n    if (isObject(data)) {\r\n      Object.entries(data).forEach(([key, value]) => this.#setToken(key, value))\r\n      return\r\n    }\r\n\r\n    this.#setAll(data)\r\n  }\r\n\r\n  resetConsent() {\r\n    Object.keys(this.#tokens).forEach(key => this.#tokens[key] = null)\r\n  }\r\n\r\n  toObject() {\r\n    return { ...this.#tokens }\r\n  }\r\n\r\n  toGTM(wait_for_update = 500) {\r\n    if (this.getState() === CONSENT_STATES.INDETERMINATE) {\r\n      const nullEntries = Object.entries(this.#tokens).filter(token => token[1] === null)\r\n      throw new Error(`All tokens must have an explicit value. Undefined token${nullEntries.length > 1 ? 's' : ''}: ${nullEntries.map(token => token[0]).join(', ')}`)\r\n    }\r\n\r\n    const { analytics_consent, ad_consent } = this.#tokens\r\n\r\n    return {\r\n      ad_user_data: ad_consent,\r\n      ad_personalization: ad_consent,\r\n      ad_consent: ad_consent,\r\n      analytics_consent: analytics_consent,\r\n      wait_for_update\r\n    }\r\n  }\r\n}"],"names":["boolTag","isBoolean","value","isObjectLike","baseGetTag","keys","Object","DEFAULT_PREFERENCES","throwOnInvalidValue","key","acceptNull","includes","TypeError","throwOnInvalidKey","message","reduce","str","i","length","tokens","_r_instances","WeakSet","e_fn","setToken","this","t_fn","setAll","forEach","ConsentTokens","constructor","__privateAdd","_n","defineProperties","analytics_consent","enumerable","get","set","functionality_consent","ad_consent","isObject","has","from","consentTokens","isGranted","CONSENT_STATES","GRANTED","isDenied","DENIED","getState","values","every","DETERMINATE","INDETERMINATE","data","entries","resetConsent","toObject","toGTM","wait_for_update","nullEntries","filter","token","Error","map","join","ad_user_data","ad_personalization"],"mappings":"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","x_google_ignoreList":[0]}