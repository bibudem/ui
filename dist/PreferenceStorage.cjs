/**
 * Librairie du system desing des Bibliothèques de l'Université de Montréal
 * @module @bibudem/ui
 * @version 0.12.0
 * @author Christian Rémillard <christian.remillard@umontreal.ca>
 * @license ISC
 * @see https://github.com/bibudem/ui
 */
var t,e,r=t=>{throw TypeError(t)},n=(t,e,n)=>(((t,e,n)=>{e.has(t)||r("Cannot "+n)})(t,e,"access private method"),n);const o=require("./index-9izUO_DB.cjs"),a=require("./constants-CCyyIJHD.cjs"),i=require("./isObjectLike-DLI4XyQI.cjs");var s=Array.isArray;function c(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var u="[object AsyncFunction]",f="[object Function]",l="[object GeneratorFunction]",p="[object Proxy]";function h(t){if(!c(t))return!1;var e=i.baseGetTag(t);return e==f||e==l||e==u||e==p}var _,b=i.root["__core-js_shared__"],y=(_=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"",v=Function.prototype.toString;function d(t){if(null!=t){try{return v.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var j=/^\[object .+?Constructor\]$/,g=Function.prototype,w=Object.prototype,O=g.toString,E=w.hasOwnProperty,m=RegExp("^"+O.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function A(t,e){var r,n,o=(n=e,null==(r=t)?void 0:r[n]);return function(t){return!(!c(t)||(e=t,y&&y in e))&&(h(t)?m:j).test(d(t));var e}(o)?o:void 0}var S=A(i.root,"WeakMap"),P=9007199254740991,T=/^(?:0|[1-9]\d*)$/;function z(t,e){var r=typeof t;return!!(e=null==e?P:e)&&("number"==r||"symbol"!=r&&T.test(t))&&t>-1&&t%1==0&&t<e}function k(t,e){return t===e||t!=t&&e!=e}var x=9007199254740991;function D(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=x}var B=Object.prototype;function N(t){return i.isObjectLike(t)&&"[object Arguments]"==i.baseGetTag(t)}var M=Object.prototype,L=M.hasOwnProperty,R=M.propertyIsEnumerable,F=N(function(){return arguments}())?N:function(t){return i.isObjectLike(t)&&L.call(t,"callee")&&!R.call(t,"callee")},U="object"==typeof exports&&exports&&!exports.nodeType&&exports,$=U&&"object"==typeof module&&module&&!module.nodeType&&module,V=$&&$.exports===U?i.root.Buffer:void 0,G=(V?V.isBuffer:void 0)||function(){return!1},I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I["[object Arguments]"]=I["[object Array]"]=I["[object ArrayBuffer]"]=I["[object Boolean]"]=I["[object DataView]"]=I["[object Date]"]=I["[object Error]"]=I["[object Function]"]=I["[object Map]"]=I["[object Number]"]=I["[object Object]"]=I["[object RegExp]"]=I["[object Set]"]=I["[object String]"]=I["[object WeakMap]"]=!1;var q,C="object"==typeof exports&&exports&&!exports.nodeType&&exports,W=C&&"object"==typeof module&&module&&!module.nodeType&&module,H=W&&W.exports===C&&i.freeGlobal.process,J=function(){try{return W&&W.require&&W.require("util").types||H&&H.binding&&H.binding("util")}catch(t){}}(),K=J&&J.isTypedArray,Q=K?(q=K,function(t){return q(t)}):function(t){return i.isObjectLike(t)&&D(t.length)&&!!I[i.baseGetTag(t)]},X=Object.prototype.hasOwnProperty,Y=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Z=Object.prototype.hasOwnProperty,tt=A(Object,"create"),et=Object.prototype.hasOwnProperty,rt=Object.prototype.hasOwnProperty;function nt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ot(t,e){for(var r=t.length;r--;)if(k(t[r][0],e))return r;return-1}nt.prototype.clear=function(){this.__data__=tt?tt(null):{},this.size=0},nt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},nt.prototype.get=function(t){var e=this.__data__;if(tt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return et.call(e,t)?e[t]:void 0},nt.prototype.has=function(t){var e=this.__data__;return tt?void 0!==e[t]:rt.call(e,t)},nt.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=tt&&void 0===e?"__lodash_hash_undefined__":e,this};var at=Array.prototype.splice;function it(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}it.prototype.clear=function(){this.__data__=[],this.size=0},it.prototype.delete=function(t){var e=this.__data__,r=ot(e,t);return!(r<0||(r==e.length-1?e.pop():at.call(e,r,1),--this.size,0))},it.prototype.get=function(t){var e=this.__data__,r=ot(e,t);return r<0?void 0:e[r][1]},it.prototype.has=function(t){return ot(this.__data__,t)>-1},it.prototype.set=function(t,e){var r=this.__data__,n=ot(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var st=A(i.root,"Map");function ct(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function ut(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ft(t){var e=this.__data__=new it(t);this.size=e.size}ut.prototype.clear=function(){this.size=0,this.__data__={hash:new nt,map:new(st||it),string:new nt}},ut.prototype.delete=function(t){var e=ct(this,t).delete(t);return this.size-=e?1:0,e},ut.prototype.get=function(t){return ct(this,t).get(t)},ut.prototype.has=function(t){return ct(this,t).has(t)},ut.prototype.set=function(t,e){var r=ct(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},ft.prototype.clear=function(){this.__data__=new it,this.size=0},ft.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},ft.prototype.get=function(t){return this.__data__.get(t)},ft.prototype.has=function(t){return this.__data__.has(t)},ft.prototype.set=function(t,e){var r=this.__data__;if(r instanceof it){var n=r.__data__;if(!st||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new ut(n)}return r.set(t,e),this.size=r.size,this};var lt=Object.prototype.propertyIsEnumerable,pt=Object.getOwnPropertySymbols,ht=pt?function(t){return null==t?[]:(t=Object(t),function(e,r){for(var n=-1,o=null==e?0:e.length,a=0,i=[];++n<o;){var s=e[n];c=s,lt.call(t,c)&&(i[a++]=s)}var c;return i}(pt(t)))}:function(){return[]};function _t(t){return r=ht,a=null!=(o=n=e=t)&&D(o.length)&&!h(o)?function(t,e){var r=s(t),n=!r&&F(t),o=!r&&!n&&G(t),a=!r&&!n&&!o&&Q(t),i=r||n||o||a,c=i?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],u=c.length;for(var f in t)!X.call(t,f)||i&&("length"==f||o&&("offset"==f||"parent"==f)||a&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||z(f,u))||c.push(f);return c}(n):function(t){if(r=(e=t)&&e.constructor,e!==("function"==typeof r&&r.prototype||B))return Y(t);var e,r,n=[];for(var o in Object(t))Z.call(t,o)&&"constructor"!=o&&n.push(o);return n}(n),s(e)?a:function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}(a,r(e));var e,r,n,o,a}var bt=A(i.root,"DataView"),yt=A(i.root,"Promise"),vt=A(i.root,"Set"),dt="[object Map]",jt="[object Promise]",gt="[object Set]",wt="[object WeakMap]",Ot="[object DataView]",Et=d(bt),mt=d(st),At=d(yt),St=d(vt),Pt=d(S),Tt=i.baseGetTag;(bt&&Tt(new bt(new ArrayBuffer(1)))!=Ot||st&&Tt(new st)!=dt||yt&&Tt(yt.resolve())!=jt||vt&&Tt(new vt)!=gt||S&&Tt(new S)!=wt)&&(Tt=function(t){var e=i.baseGetTag(t),r="[object Object]"==e?t.constructor:void 0,n=r?d(r):"";if(n)switch(n){case Et:return Ot;case mt:return dt;case At:return jt;case St:return gt;case Pt:return wt}return e});var zt=i.root.Uint8Array;function kt(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new ut;++e<r;)this.add(t[e])}function xt(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}kt.prototype.add=kt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},kt.prototype.has=function(t){return this.__data__.has(t)};var Dt=1,Bt=2;function Nt(t,e,r,n,o,a){var i=r&Dt,s=t.length,c=e.length;if(s!=c&&!(i&&c>s))return!1;var u=a.get(t),f=a.get(e);if(u&&f)return u==e&&f==t;var l=-1,p=!0,h=r&Bt?new kt:void 0;for(a.set(t,e),a.set(e,t);++l<s;){var _=t[l],b=e[l];if(n)var y=i?n(b,_,l,e,t,a):n(_,b,l,t,e,a);if(void 0!==y){if(y)continue;p=!1;break}if(h){if(!xt(e,(function(t,e){if(i=e,!h.has(i)&&(_===t||o(_,t,r,n,a)))return h.push(e);var i}))){p=!1;break}}else if(_!==b&&!o(_,b,r,n,a)){p=!1;break}}return a.delete(t),a.delete(e),p}function Mt(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function Lt(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var Rt=i.Symbol?i.Symbol.prototype:void 0,Ft=Rt?Rt.valueOf:void 0,Ut=Object.prototype.hasOwnProperty,$t="[object Arguments]",Vt="[object Array]",Gt="[object Object]",It=Object.prototype.hasOwnProperty;function qt(t,e,r,n,o){return t===e||(null==t||null==e||!i.isObjectLike(t)&&!i.isObjectLike(e)?t!=t&&e!=e:function(t,e,r,n,o,a){var i=s(t),c=s(e),u=i?Vt:Tt(t),f=c?Vt:Tt(e),l=(u=u==$t?Gt:u)==Gt,p=(f=f==$t?Gt:f)==Gt,h=u==f;if(h&&G(t)){if(!G(e))return!1;i=!0,l=!1}if(h&&!l)return a||(a=new ft),i||Q(t)?Nt(t,e,r,n,o,a):function(t,e,r,n,o,a,i){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new zt(t),new zt(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return k(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=Mt;case"[object Set]":var c=1&n;if(s||(s=Lt),t.size!=e.size&&!c)return!1;var u=i.get(t);if(u)return u==e;n|=2,i.set(t,e);var f=Nt(s(t),s(e),n,o,a,i);return i.delete(t),f;case"[object Symbol]":if(Ft)return Ft.call(t)==Ft.call(e)}return!1}(t,e,u,r,n,o,a);if(!(1&r)){var _=l&&It.call(t,"__wrapped__"),b=p&&It.call(e,"__wrapped__");if(_||b){var y=_?t.value():t,v=b?e.value():e;return a||(a=new ft),o(y,v,r,n,a)}}return!!h&&(a||(a=new ft),function(t,e,r,n,o,a){var i=1&r,s=_t(t),c=s.length;if(c!=_t(e).length&&!i)return!1;for(var u=c;u--;){var f=s[u];if(!(i?f in e:Ut.call(e,f)))return!1}var l=a.get(t),p=a.get(e);if(l&&p)return l==e&&p==t;var h=!0;a.set(t,e),a.set(e,t);for(var _=i;++u<c;){var b=t[f=s[u]],y=e[f];if(n)var v=i?n(y,b,f,e,t,a):n(b,y,f,t,e,a);if(!(void 0===v?b===y||o(b,y,r,n,a):v)){h=!1;break}_||(_="constructor"==f)}if(h&&!_){var d=t.constructor,j=e.constructor;d==j||!("constructor"in t)||!("constructor"in e)||"function"==typeof d&&d instanceof d&&"function"==typeof j&&j instanceof j||(h=!1)}return a.delete(t),a.delete(e),h}(t,e,r,n,o,a))}(t,e,r,n,qt,o))}class Ct extends EventTarget{constructor(){var e,n,o;super(),e=this,(n=t).has(e)?r("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,o),this.db=null}listen(t){super.addEventListener(a.EVENT_NAMES.UPDATE,t)}dispatchEvent({detail:t}){console.log(`Dispatching ${a.EVENT_NAMES.UPDATE} event with data:`,t),super.dispatchEvent(new CustomEvent(a.EVENT_NAMES.UPDATE,{detail:t}))}async init(){try{this.db=await o.openDB(a.DB_NAME,a.DB_VERSION,{upgrade(t){t.objectStoreNames.contains(a.DB_STORE_NAME)||t.createObjectStore(a.DB_STORE_NAME)}})}catch(t){throw new Error("Something went wrong with indexedDB:",t)}}async getPreferences(){const t=await this.db.get(a.DB_STORE_NAME,"preferences");return void 0===t?null:t}async setPreferences(r){if(!c(r))throw new TypeError("Preferences must be an object.");const o=Object.keys(a.DEFAULT_PREFERENCES);if(!function(t,e){if(t.length!==e.length)return!1;const r=[...t].sort(),n=[...e].sort();return r.every(((t,e)=>t===n[e]))}(o,Object.keys(r)))throw new TypeError(`Preferences requires all those fields: ${o.join(", ")}.`);if(!Object.values(r).every((t=>"boolean"==typeof t)))throw new TypeError("Preferences values must be a boolean.");return await n(this,t,e).call(this,r)}async resetPreferences(){return await n(this,t,e).call(this,null)}}let Wt;t=new WeakSet,e=async function(t){try{return qt(await this.getPreferences(),t)?(console.log("[setPreferences] preferences not updated: ",t),!1):(await this.db.put(a.DB_STORE_NAME,t,"preferences"),console.log("[setPreferences] preferences updated: ",t),t)}catch(e){throw new Error("Something went wrong with indexedDB:",e)}},module.exports=async function(){return Wt||(Wt=new Ct,await Wt.init()),Wt};
//# sourceMappingURL=PreferenceStorage.cjs.map
