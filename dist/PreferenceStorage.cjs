/**
 * Librairie du system desing des Bibliothèques de l'Université de Montréal
 * @module @bibudem/ui
 * @version 0.10.1
 * @author Christian Rémillard <christian.remillard@umontreal.ca>
 * @license ISC
 * @see https://github.com/bibudem/ui
 */
var e,t,r=e=>{throw TypeError(e)},n=(e,t,n)=>(((e,t,n)=>{t.has(e)||r("Cannot "+n)})(e,t,"access private method"),n);const o=require("./index-9izUO_DB.cjs"),a=require("./utils-CpyYfGsw.cjs"),i=require("./isObjectLike-DLI4XyQI.cjs");var s=Array.isArray;function c(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var u="[object AsyncFunction]",f="[object Function]",l="[object GeneratorFunction]",p="[object Proxy]";function h(e){if(!c(e))return!1;var t=i.baseGetTag(e);return t==f||t==l||t==u||t==p}var _,b=i.root["__core-js_shared__"],y=(_=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"",d=Function.prototype.toString;function v(e){if(null!=e){try{return d.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var j=/^\[object .+?Constructor\]$/,g=Function.prototype,w=Object.prototype,O=g.toString,E=w.hasOwnProperty,m=RegExp("^"+O.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function A(e,t){var r,n,o=(n=t,null==(r=e)?void 0:r[n]);return function(e){return!(!c(e)||(t=e,y&&y in t))&&(h(e)?m:j).test(v(e));var t}(o)?o:void 0}var S=A(i.root,"WeakMap"),P=9007199254740991,T=/^(?:0|[1-9]\d*)$/;function z(e,t){var r=typeof e;return!!(t=null==t?P:t)&&("number"==r||"symbol"!=r&&T.test(e))&&e>-1&&e%1==0&&e<t}function k(e,t){return e===t||e!=e&&t!=t}var x=9007199254740991;function D(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=x}var B=Object.prototype;function N(e){return i.isObjectLike(e)&&"[object Arguments]"==i.baseGetTag(e)}var M=Object.prototype,L=M.hasOwnProperty,R=M.propertyIsEnumerable,F=N(function(){return arguments}())?N:function(e){return i.isObjectLike(e)&&L.call(e,"callee")&&!R.call(e,"callee")},U="object"==typeof exports&&exports&&!exports.nodeType&&exports,$=U&&"object"==typeof module&&module&&!module.nodeType&&module,V=$&&$.exports===U?i.root.Buffer:void 0,G=(V?V.isBuffer:void 0)||function(){return!1},I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I["[object Arguments]"]=I["[object Array]"]=I["[object ArrayBuffer]"]=I["[object Boolean]"]=I["[object DataView]"]=I["[object Date]"]=I["[object Error]"]=I["[object Function]"]=I["[object Map]"]=I["[object Number]"]=I["[object Object]"]=I["[object RegExp]"]=I["[object Set]"]=I["[object String]"]=I["[object WeakMap]"]=!1;var q,C="object"==typeof exports&&exports&&!exports.nodeType&&exports,W=C&&"object"==typeof module&&module&&!module.nodeType&&module,H=W&&W.exports===C&&i.freeGlobal.process,J=function(){try{return W&&W.require&&W.require("util").types||H&&H.binding&&H.binding("util")}catch(e){}}(),K=J&&J.isTypedArray,Q=K?(q=K,function(e){return q(e)}):function(e){return i.isObjectLike(e)&&D(e.length)&&!!I[i.baseGetTag(e)]},X=Object.prototype.hasOwnProperty,Y=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Z=Object.prototype.hasOwnProperty,ee=A(Object,"create"),te=Object.prototype.hasOwnProperty,re=Object.prototype.hasOwnProperty;function ne(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function oe(e,t){for(var r=e.length;r--;)if(k(e[r][0],t))return r;return-1}ne.prototype.clear=function(){this.__data__=ee?ee(null):{},this.size=0},ne.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ne.prototype.get=function(e){var t=this.__data__;if(ee){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return te.call(t,e)?t[e]:void 0},ne.prototype.has=function(e){var t=this.__data__;return ee?void 0!==t[e]:re.call(t,e)},ne.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ee&&void 0===t?"__lodash_hash_undefined__":t,this};var ae=Array.prototype.splice;function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ie.prototype.clear=function(){this.__data__=[],this.size=0},ie.prototype.delete=function(e){var t=this.__data__,r=oe(t,e);return!(r<0||(r==t.length-1?t.pop():ae.call(t,r,1),--this.size,0))},ie.prototype.get=function(e){var t=this.__data__,r=oe(t,e);return r<0?void 0:t[r][1]},ie.prototype.has=function(e){return oe(this.__data__,e)>-1},ie.prototype.set=function(e,t){var r=this.__data__,n=oe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var se=A(i.root,"Map");function ce(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function ue(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function fe(e){var t=this.__data__=new ie(e);this.size=t.size}ue.prototype.clear=function(){this.size=0,this.__data__={hash:new ne,map:new(se||ie),string:new ne}},ue.prototype.delete=function(e){var t=ce(this,e).delete(e);return this.size-=t?1:0,t},ue.prototype.get=function(e){return ce(this,e).get(e)},ue.prototype.has=function(e){return ce(this,e).has(e)},ue.prototype.set=function(e,t){var r=ce(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},fe.prototype.clear=function(){this.__data__=new ie,this.size=0},fe.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},fe.prototype.get=function(e){return this.__data__.get(e)},fe.prototype.has=function(e){return this.__data__.has(e)},fe.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ie){var n=r.__data__;if(!se||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ue(n)}return r.set(e,t),this.size=r.size,this};var le=Object.prototype.propertyIsEnumerable,pe=Object.getOwnPropertySymbols,he=pe?function(e){return null==e?[]:(e=Object(e),function(t,r){for(var n=-1,o=null==t?0:t.length,a=0,i=[];++n<o;){var s=t[n];c=s,le.call(e,c)&&(i[a++]=s)}var c;return i}(pe(e)))}:function(){return[]};function _e(e){return r=he,a=null!=(o=n=t=e)&&D(o.length)&&!h(o)?function(e,t){var r=s(e),n=!r&&F(e),o=!r&&!n&&G(e),a=!r&&!n&&!o&&Q(e),i=r||n||o||a,c=i?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],u=c.length;for(var f in e)!X.call(e,f)||i&&("length"==f||o&&("offset"==f||"parent"==f)||a&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||z(f,u))||c.push(f);return c}(n):function(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||B))return Y(e);var t,r,n=[];for(var o in Object(e))Z.call(e,o)&&"constructor"!=o&&n.push(o);return n}(n),s(t)?a:function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}(a,r(t));var t,r,n,o,a}var be=A(i.root,"DataView"),ye=A(i.root,"Promise"),de=A(i.root,"Set"),ve="[object Map]",je="[object Promise]",ge="[object Set]",we="[object WeakMap]",Oe="[object DataView]",Ee=v(be),me=v(se),Ae=v(ye),Se=v(de),Pe=v(S),Te=i.baseGetTag;(be&&Te(new be(new ArrayBuffer(1)))!=Oe||se&&Te(new se)!=ve||ye&&Te(ye.resolve())!=je||de&&Te(new de)!=ge||S&&Te(new S)!=we)&&(Te=function(e){var t=i.baseGetTag(e),r="[object Object]"==t?e.constructor:void 0,n=r?v(r):"";if(n)switch(n){case Ee:return Oe;case me:return ve;case Ae:return je;case Se:return ge;case Pe:return we}return t});var ze=i.root.Uint8Array;function ke(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ue;++t<r;)this.add(e[t])}function xe(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}ke.prototype.add=ke.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},ke.prototype.has=function(e){return this.__data__.has(e)};var De=1,Be=2;function Ne(e,t,r,n,o,a){var i=r&De,s=e.length,c=t.length;if(s!=c&&!(i&&c>s))return!1;var u=a.get(e),f=a.get(t);if(u&&f)return u==t&&f==e;var l=-1,p=!0,h=r&Be?new ke:void 0;for(a.set(e,t),a.set(t,e);++l<s;){var _=e[l],b=t[l];if(n)var y=i?n(b,_,l,t,e,a):n(_,b,l,e,t,a);if(void 0!==y){if(y)continue;p=!1;break}if(h){if(!xe(t,(function(e,t){if(i=t,!h.has(i)&&(_===e||o(_,e,r,n,a)))return h.push(t);var i}))){p=!1;break}}else if(_!==b&&!o(_,b,r,n,a)){p=!1;break}}return a.delete(e),a.delete(t),p}function Me(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function Le(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var Re=i.Symbol?i.Symbol.prototype:void 0,Fe=Re?Re.valueOf:void 0,Ue=Object.prototype.hasOwnProperty,$e="[object Arguments]",Ve="[object Array]",Ge="[object Object]",Ie=Object.prototype.hasOwnProperty;function qe(e,t,r,n,o){return e===t||(null==e||null==t||!i.isObjectLike(e)&&!i.isObjectLike(t)?e!=e&&t!=t:function(e,t,r,n,o,a){var i=s(e),c=s(t),u=i?Ve:Te(e),f=c?Ve:Te(t),l=(u=u==$e?Ge:u)==Ge,p=(f=f==$e?Ge:f)==Ge,h=u==f;if(h&&G(e)){if(!G(t))return!1;i=!0,l=!1}if(h&&!l)return a||(a=new fe),i||Q(e)?Ne(e,t,r,n,o,a):function(e,t,r,n,o,a,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new ze(e),new ze(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return k(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Me;case"[object Set]":var c=1&n;if(s||(s=Le),e.size!=t.size&&!c)return!1;var u=i.get(e);if(u)return u==t;n|=2,i.set(e,t);var f=Ne(s(e),s(t),n,o,a,i);return i.delete(e),f;case"[object Symbol]":if(Fe)return Fe.call(e)==Fe.call(t)}return!1}(e,t,u,r,n,o,a);if(!(1&r)){var _=l&&Ie.call(e,"__wrapped__"),b=p&&Ie.call(t,"__wrapped__");if(_||b){var y=_?e.value():e,d=b?t.value():t;return a||(a=new fe),o(y,d,r,n,a)}}return!!h&&(a||(a=new fe),function(e,t,r,n,o,a){var i=1&r,s=_e(e),c=s.length;if(c!=_e(t).length&&!i)return!1;for(var u=c;u--;){var f=s[u];if(!(i?f in t:Ue.call(t,f)))return!1}var l=a.get(e),p=a.get(t);if(l&&p)return l==t&&p==e;var h=!0;a.set(e,t),a.set(t,e);for(var _=i;++u<c;){var b=e[f=s[u]],y=t[f];if(n)var d=i?n(y,b,f,t,e,a):n(b,y,f,e,t,a);if(!(void 0===d?b===y||o(b,y,r,n,a):d)){h=!1;break}_||(_="constructor"==f)}if(h&&!_){var v=e.constructor,j=t.constructor;v==j||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof j&&j instanceof j||(h=!1)}return a.delete(e),a.delete(t),h}(e,t,r,n,o,a))}(e,t,r,n,qe,o))}class Ce extends EventTarget{constructor(){var t,n,o;super(),t=this,(n=e).has(t)?r("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(t):n.set(t,o),this.db=null}listen(e){super.addEventListener(a.EVENT_NAMES.UPDATE,e)}dispatchEvent({detail:e}){console.log(`Dispatching ${a.EVENT_NAMES.UPDATE} event with data:`,e),super.dispatchEvent(new CustomEvent(a.EVENT_NAMES.UPDATE,{detail:e}))}async init(){try{this.db=await o.openDB(a.DB_NAME,a.DB_VERSION,{upgrade(e){e.objectStoreNames.contains(a.DB_STORE_NAME)||e.createObjectStore(a.DB_STORE_NAME)}})}catch(e){throw new Error("Something went wrong with indexedDB:",e)}}async getPreferences(){const e=await this.db.get(a.DB_STORE_NAME,"preferences");return void 0===e?null:e}async setPreferences(r){if(!c(r))throw new TypeError("Preferences must be an object.");const o=Object.keys(a.DEFAULT_PREFERENCES);if(!function(e,t){if(e.length!==t.length)return!1;const r=[...e].sort(),n=[...t].sort();return r.every(((e,t)=>e===n[t]))}(o,Object.keys(r)))throw new TypeError(`Preferences requires all those fields: ${o.join(", ")}.`);if(!Object.values(r).every((e=>"boolean"==typeof e)))throw new TypeError("Preferences values must be a boolean.");return await n(this,e,t).call(this,r)}async resetPreferences(){return await n(this,e,t).call(this,null)}}let We;e=new WeakSet,t=async function(e){try{return qe(await this.getPreferences(),e)?(console.log("[setPreferences] preferences not updated: ",e),!1):(await this.db.put(a.DB_STORE_NAME,e,"preferences"),console.log("[setPreferences] preferences updated: ",e),e)}catch(t){throw new Error("Something went wrong with indexedDB:",t)}},module.exports=async function(){return We||(We=new Ce,await We.init()),We};
//# sourceMappingURL=PreferenceStorage.cjs.map
