/**
 * Librairie du system desing des Bibliothèques de l'Université de Montréal
 * @module @bibudem/ui
 * @version 0.13.2
 * @author Christian Rémillard <christian.remillard@umontreal.ca>
 * @license ISC
 * @see https://github.com/bibudem/ui
 */
var e,t,r=e=>{throw TypeError(e)},n=(e,t,n)=>(((e,t,n)=>{t.has(e)||r("Cannot "+n)})(e,t,"access private method"),n);const a=require("./index-9izUO_DB.cjs"),o=require("./constants-BxiUuqDD.cjs"),c=require("./_Uint8Array-Dn54l80h.cjs"),i=require("./isObjectLike-DLI4XyQI.cjs");var s=c.getNative(i.root,"WeakMap"),u=c.overArg(Object.keys,Object),f=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,b=Object.getOwnPropertySymbols,h=b?function(e){return null==e?[]:(e=Object(e),function(t,r){for(var n=-1,a=null==t?0:t.length,o=0,c=[];++n<a;){var i=t[n];s=i,l.call(e,s)&&(c[o++]=i)}var s;return c}(b(e)))}:function(){return[]};function v(e){return r=h,n=t=e,a=c.isArrayLike(n)?c.arrayLikeKeys(n):function(e){if(!c.isPrototype(e))return u(e);var t=[];for(var r in Object(e))f.call(e,r)&&"constructor"!=r&&t.push(r);return t}(n),c.isArray(t)?a:function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}(a,r(t));var t,r,n,a}var p=c.getNative(i.root,"DataView"),y=c.getNative(i.root,"Promise"),d=c.getNative(i.root,"Set"),w="[object Map]",j="[object Promise]",g="[object Set]",_="[object WeakMap]",E="[object DataView]",O=c.toSource(p),S=c.toSource(c.Map),m=c.toSource(y),A=c.toSource(d),k=c.toSource(s),N=i.baseGetTag;function P(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new c.MapCache;++t<r;)this.add(e[t])}function T(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}(p&&N(new p(new ArrayBuffer(1)))!=E||c.Map&&N(new c.Map)!=w||y&&N(y.resolve())!=j||d&&N(new d)!=g||s&&N(new s)!=_)&&(N=function(e){var t=i.baseGetTag(e),r="[object Object]"==t?e.constructor:void 0,n=r?c.toSource(r):"";if(n)switch(n){case O:return E;case S:return w;case m:return j;case A:return g;case k:return _}return t}),P.prototype.add=P.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},P.prototype.has=function(e){return this.__data__.has(e)};var D=1,M=2;function B(e,t,r,n,a,o){var c=r&D,i=e.length,s=t.length;if(i!=s&&!(c&&s>i))return!1;var u=o.get(e),f=o.get(t);if(u&&f)return u==t&&f==e;var l=-1,b=!0,h=r&M?new P:void 0;for(o.set(e,t),o.set(t,e);++l<i;){var v=e[l],p=t[l];if(n)var y=c?n(p,v,l,t,e,o):n(v,p,l,e,t,o);if(void 0!==y){if(y)continue;b=!1;break}if(h){if(!T(t,(function(e,t){if(c=t,!h.has(c)&&(v===e||a(v,e,r,n,o)))return h.push(t);var c}))){b=!1;break}}else if(v!==p&&!a(v,p,r,n,o)){b=!1;break}}return o.delete(e),o.delete(t),b}function L(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function R(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var q=i.Symbol?i.Symbol.prototype:void 0,x=q?q.valueOf:void 0,U=Object.prototype.hasOwnProperty,V="[object Arguments]",C="[object Array]",z="[object Object]",W=Object.prototype.hasOwnProperty;function F(e,t,r,n,a){return e===t||(null==e||null==t||!i.isObjectLike(e)&&!i.isObjectLike(t)?e!=e&&t!=t:function(e,t,r,n,a,o){var i=c.isArray(e),s=c.isArray(t),u=i?C:N(e),f=s?C:N(t),l=(u=u==V?z:u)==z,b=(f=f==V?z:f)==z,h=u==f;if(h&&c.isBuffer(e)){if(!c.isBuffer(t))return!1;i=!0,l=!1}if(h&&!l)return o||(o=new c.Stack),i||c.isTypedArray(e)?B(e,t,r,n,a,o):function(e,t,r,n,a,o,i){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new c.Uint8Array(e),new c.Uint8Array(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return c.eq(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=L;case"[object Set]":var u=1&n;if(s||(s=R),e.size!=t.size&&!u)return!1;var f=i.get(e);if(f)return f==t;n|=2,i.set(e,t);var l=B(s(e),s(t),n,a,o,i);return i.delete(e),l;case"[object Symbol]":if(x)return x.call(e)==x.call(t)}return!1}(e,t,u,r,n,a,o);if(!(1&r)){var p=l&&W.call(e,"__wrapped__"),y=b&&W.call(t,"__wrapped__");if(p||y){var d=p?e.value():e,w=y?t.value():t;return o||(o=new c.Stack),a(d,w,r,n,o)}}return!!h&&(o||(o=new c.Stack),function(e,t,r,n,a,o){var c=1&r,i=v(e),s=i.length;if(s!=v(t).length&&!c)return!1;for(var u=s;u--;){var f=i[u];if(!(c?f in t:U.call(t,f)))return!1}var l=o.get(e),b=o.get(t);if(l&&b)return l==t&&b==e;var h=!0;o.set(e,t),o.set(t,e);for(var p=c;++u<s;){var y=e[f=i[u]],d=t[f];if(n)var w=c?n(d,y,f,t,e,o):n(y,d,f,e,t,o);if(!(void 0===w?y===d||a(y,d,r,n,o):w)){h=!1;break}p||(p="constructor"==f)}if(h&&!p){var j=e.constructor,g=t.constructor;j==g||!("constructor"in e)||!("constructor"in t)||"function"==typeof j&&j instanceof j&&"function"==typeof g&&g instanceof g||(h=!1)}return o.delete(e),o.delete(t),h}(e,t,r,n,a,o))}(e,t,r,n,F,a))}class G extends EventTarget{constructor(){var t,n,a;super(),t=this,(n=e).has(t)?r("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(t):n.set(t,a),this.db=null}listen(e){super.addEventListener(o.EVENT_NAMES.UPDATE,e)}dispatchEvent({detail:e}){super.dispatchEvent(new CustomEvent(o.EVENT_NAMES.UPDATE,{detail:e}))}async init(){try{this.db=await a.openDB(o.DB_NAME,o.DB_VERSION,{upgrade(e){e.objectStoreNames.contains(o.DB_STORE_NAME)||e.createObjectStore(o.DB_STORE_NAME)}})}catch(e){throw new Error("Something went wrong with indexedDB:",e)}}async getPreferences(){const e=await this.db.get(o.DB_STORE_NAME,"preferences");return void 0===e?null:e}async setPreferences(r){if(!c.isObject(r))throw new TypeError("Preferences must be an object.");const a=Object.keys(o.DEFAULT_PREFERENCES);if(!function(e,t){if(e.length!==t.length)return!1;const r=[...e].sort(),n=[...t].sort();return r.every(((e,t)=>e===n[t]))}(a,Object.keys(r)))throw new TypeError(`Preferences requires all those fields: ${a.join(", ")}.`);if(!Object.values(r).every((e=>"boolean"==typeof e)))throw new TypeError("Preferences values must be a boolean.");return await n(this,e,t).call(this,r)}async resetPreferences(){return await n(this,e,t).call(this,null)}}let I;e=new WeakSet,t=async function(e){try{return!F(await this.getPreferences(),e)&&(await this.db.put(o.DB_STORE_NAME,e,"preferences"),e)}catch(t){throw new Error("Something went wrong with indexedDB:",t)}},module.exports=async function(){return I||(I=new G,await I.init()),I};
//# sourceMappingURL=PreferenceStorage.cjs.map
