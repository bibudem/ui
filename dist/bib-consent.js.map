{"version":3,"file":"bib-consent.js","sources":["../node_modules/@lit/context/lib/value-notifier.js","../node_modules/@lit/context/lib/controllers/context-provider.js","isObject-Dipzh7kZ.js","_Uint8Array-Cf-PTZCw.js","../src/components/bib-consent/bib-consent.js"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\nclass s{get value(){return this.o}set value(s){this.setValue(s)}setValue(s,t=!1){const i=t||!Object.is(s,this.o);this.o=s,i&&this.updateObservers()}constructor(s){this.subscriptions=new Map,this.updateObservers=()=>{for(const[s,{disposer:t}]of this.subscriptions)s(this.o,t)},void 0!==s&&(this.value=s)}addCallback(s,t,i){if(!i)return void s(this.value);this.subscriptions.has(s)||this.subscriptions.set(s,{disposer:()=>{this.subscriptions.delete(s)},consumerHost:t});const{disposer:h}=this.subscriptions.get(s);s(this.value,h)}clearCallbacks(){this.subscriptions.clear()}}export{s as ValueNotifier};\n//# sourceMappingURL=value-notifier.js.map\n","import{ContextRequestEvent as t}from\"../context-request-event.js\";import{ValueNotifier as s}from\"../value-notifier.js\";\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */class e extends Event{constructor(t){super(\"context-provider\",{bubbles:!0,composed:!0}),this.context=t}}class i extends s{constructor(s,e,i){super(void 0!==e.context?e.initialValue:i),this.onContextRequest=t=>{const s=t.composedPath()[0];t.context===this.context&&s!==this.host&&(t.stopPropagation(),this.addCallback(t.callback,s,t.subscribe))},this.onProviderRequest=s=>{const e=s.composedPath()[0];if(s.context!==this.context||e===this.host)return;const i=new Set;for(const[s,{consumerHost:e}]of this.subscriptions)i.has(s)||(i.add(s),e.dispatchEvent(new t(this.context,s,!0)));s.stopPropagation()},this.host=s,void 0!==e.context?this.context=e.context:this.context=e,this.attachListeners(),this.host.addController?.(this)}attachListeners(){this.host.addEventListener(\"context-request\",this.onContextRequest),this.host.addEventListener(\"context-provider\",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new e(this.context))}}export{i as ContextProvider,e as ContextProviderEvent};\n//# sourceMappingURL=context-provider.js.map\n","/**\n * Librairie du system desing des Bibliothèques de l'Université de Montréal\n * @module @bibudem/ui\n * @version 1.3.0\n * @author Christian Rémillard <christian.remillard@umontreal.ca>\n * @license ISC\n * @see https://github.com/bibudem/ui\n */\nvar t = \"object\" == typeof global && global && global.Object === Object && global, e = \"object\" == typeof self && self && self.Object === Object && self, o = t || e || Function(\"return this\")(), n = o.Symbol, l = Object.prototype, r = l.hasOwnProperty, c = l.toString, a = n ? n.toStringTag : void 0, b = Object.prototype.toString, i = n ? n.toStringTag : void 0;\nfunction u(t2) {\n  return null == t2 ? void 0 === t2 ? \"[object Undefined]\" : \"[object Null]\" : i && i in Object(t2) ? function(t3) {\n    var e2 = r.call(t3, a), o2 = t3[a];\n    try {\n      t3[a] = void 0;\n      var n2 = true;\n    } catch (t4) {\n    }\n    var l2 = c.call(t3);\n    return n2 && (e2 ? t3[a] = o2 : delete t3[a]), l2;\n  }(t2) : function(t3) {\n    return b.call(t3);\n  }(t2);\n}\nfunction f(t2) {\n  return null != t2 && \"object\" == typeof t2;\n}\nfunction j(t2) {\n  var e2 = typeof t2;\n  return null != t2 && (\"object\" == e2 || \"function\" == e2);\n}\nexport {\n  n as S,\n  j as a,\n  u as b,\n  t as f,\n  f as i,\n  o as r\n};\n//# sourceMappingURL=isObject-Dipzh7kZ.js.map\n","/**\n * Librairie du system desing des Bibliothèques de l'Université de Montréal\n * @module @bibudem/ui\n * @version 1.3.0\n * @author Christian Rémillard <christian.remillard@umontreal.ca>\n * @license ISC\n * @see https://github.com/bibudem/ui\n */\nimport { a as t, b as e, r, i as o, f as n } from \"./isObject-Dipzh7kZ.js\";\nvar a = Array.isArray, i = \"[object AsyncFunction]\", s = \"[object Function]\", u = \"[object GeneratorFunction]\", c = \"[object Proxy]\";\nfunction p(r2) {\n  if (!t(r2)) return false;\n  var o2 = e(r2);\n  return o2 == s || o2 == u || o2 == i || o2 == c;\n}\nvar _, h = r[\"__core-js_shared__\"], f = (_ = /[^.]+$/.exec(h && h.keys && h.keys.IE_PROTO || \"\")) ? \"Symbol(src)_1.\" + _ : \"\", l = Function.prototype.toString;\nfunction y(t2) {\n  if (null != t2) {\n    try {\n      return l.call(t2);\n    } catch (t3) {\n    }\n    try {\n      return t2 + \"\";\n    } catch (t3) {\n    }\n  }\n  return \"\";\n}\nvar d = /^\\[object .+?Constructor\\]$/, b = Function.prototype, v = Object.prototype, j = b.toString, g = v.hasOwnProperty, m = RegExp(\"^\" + j.call(g).replace(/[\\\\^$.*+?()[\\]{}|]/g, \"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, \"$1.*?\") + \"$\");\nfunction z(e2, r2) {\n  var o2 = function(t2, e3) {\n    return null == t2 ? void 0 : t2[e3];\n  }(e2, r2);\n  return function(e3) {\n    return !(!t(e3) || (r3 = e3, f && f in r3)) && (p(e3) ? m : d).test(y(e3));\n    var r3;\n  }(o2) ? o2 : void 0;\n}\nvar A = 9007199254740991, O = /^(?:0|[1-9]\\d*)$/;\nfunction x(t2, e2) {\n  var r2 = typeof t2;\n  return !!(e2 = null == e2 ? A : e2) && (\"number\" == r2 || \"symbol\" != r2 && O.test(t2)) && t2 > -1 && t2 % 1 == 0 && t2 < e2;\n}\nfunction w(t2, e2) {\n  return t2 === e2 || t2 != t2 && e2 != e2;\n}\nvar F = 9007199254740991;\nfunction P(t2) {\n  return \"number\" == typeof t2 && t2 > -1 && t2 % 1 == 0 && t2 <= F;\n}\nfunction S(t2) {\n  return null != t2 && P(t2.length) && !p(t2);\n}\nvar $ = Object.prototype;\nfunction T(t2) {\n  var e2 = t2 && t2.constructor;\n  return t2 === (\"function\" == typeof e2 && e2.prototype || $);\n}\nfunction U(t2) {\n  return o(t2) && \"[object Arguments]\" == e(t2);\n}\nvar E = Object.prototype, I = E.hasOwnProperty, k = E.propertyIsEnumerable, B = U(/* @__PURE__ */ function() {\n  return arguments;\n}()) ? U : function(t2) {\n  return o(t2) && I.call(t2, \"callee\") && !k.call(t2, \"callee\");\n}, M = \"object\" == typeof exports && exports && !exports.nodeType && exports, R = M && \"object\" == typeof module && module && !module.nodeType && module, q = R && R.exports === M ? r.Buffer : void 0, C = (q ? q.isBuffer : void 0) || function() {\n  return false;\n}, D = {};\nD[\"[object Float32Array]\"] = D[\"[object Float64Array]\"] = D[\"[object Int8Array]\"] = D[\"[object Int16Array]\"] = D[\"[object Int32Array]\"] = D[\"[object Uint8Array]\"] = D[\"[object Uint8ClampedArray]\"] = D[\"[object Uint16Array]\"] = D[\"[object Uint32Array]\"] = true, D[\"[object Arguments]\"] = D[\"[object Array]\"] = D[\"[object ArrayBuffer]\"] = D[\"[object Boolean]\"] = D[\"[object DataView]\"] = D[\"[object Date]\"] = D[\"[object Error]\"] = D[\"[object Function]\"] = D[\"[object Map]\"] = D[\"[object Number]\"] = D[\"[object Object]\"] = D[\"[object RegExp]\"] = D[\"[object Set]\"] = D[\"[object String]\"] = D[\"[object WeakMap]\"] = false;\nvar G, L = \"object\" == typeof exports && exports && !exports.nodeType && exports, N = L && \"object\" == typeof module && module && !module.nodeType && module, V = N && N.exports === L && n.process, W = function() {\n  try {\n    return N && N.require && N.require(\"util\").types || V && V.binding && V.binding(\"util\");\n  } catch (t2) {\n  }\n}(), H = W && W.isTypedArray, J = H ? (G = H, function(t2) {\n  return G(t2);\n}) : function(t2) {\n  return o(t2) && P(t2.length) && !!D[e(t2)];\n}, K = Object.prototype.hasOwnProperty;\nfunction Q(t2, e2) {\n  var r2 = a(t2), o2 = !r2 && B(t2), n2 = !r2 && !o2 && C(t2), i2 = !r2 && !o2 && !n2 && J(t2), s2 = r2 || o2 || n2 || i2, u2 = s2 ? function(t3, e3) {\n    for (var r3 = -1, o3 = Array(t3); ++r3 < t3; ) o3[r3] = e3(r3);\n    return o3;\n  }(t2.length, String) : [], c2 = u2.length;\n  for (var p2 in t2) !e2 && !K.call(t2, p2) || s2 && (\"length\" == p2 || n2 && (\"offset\" == p2 || \"parent\" == p2) || i2 && (\"buffer\" == p2 || \"byteLength\" == p2 || \"byteOffset\" == p2) || x(p2, c2)) || u2.push(p2);\n  return u2;\n}\nfunction X(t2, e2) {\n  return function(r2) {\n    return t2(e2(r2));\n  };\n}\nvar Y = z(Object, \"create\"), Z = Object.prototype.hasOwnProperty, tt = Object.prototype.hasOwnProperty;\nfunction et(t2) {\n  var e2 = -1, r2 = null == t2 ? 0 : t2.length;\n  for (this.clear(); ++e2 < r2; ) {\n    var o2 = t2[e2];\n    this.set(o2[0], o2[1]);\n  }\n}\nfunction rt(t2, e2) {\n  for (var r2 = t2.length; r2--; ) if (w(t2[r2][0], e2)) return r2;\n  return -1;\n}\net.prototype.clear = function() {\n  this.__data__ = Y ? Y(null) : {}, this.size = 0;\n}, et.prototype.delete = function(t2) {\n  var e2 = this.has(t2) && delete this.__data__[t2];\n  return this.size -= e2 ? 1 : 0, e2;\n}, et.prototype.get = function(t2) {\n  var e2 = this.__data__;\n  if (Y) {\n    var r2 = e2[t2];\n    return \"__lodash_hash_undefined__\" === r2 ? void 0 : r2;\n  }\n  return Z.call(e2, t2) ? e2[t2] : void 0;\n}, et.prototype.has = function(t2) {\n  var e2 = this.__data__;\n  return Y ? void 0 !== e2[t2] : tt.call(e2, t2);\n}, et.prototype.set = function(t2, e2) {\n  var r2 = this.__data__;\n  return this.size += this.has(t2) ? 0 : 1, r2[t2] = Y && void 0 === e2 ? \"__lodash_hash_undefined__\" : e2, this;\n};\nvar ot = Array.prototype.splice;\nfunction nt(t2) {\n  var e2 = -1, r2 = null == t2 ? 0 : t2.length;\n  for (this.clear(); ++e2 < r2; ) {\n    var o2 = t2[e2];\n    this.set(o2[0], o2[1]);\n  }\n}\nnt.prototype.clear = function() {\n  this.__data__ = [], this.size = 0;\n}, nt.prototype.delete = function(t2) {\n  var e2 = this.__data__, r2 = rt(e2, t2);\n  return !(r2 < 0 || (r2 == e2.length - 1 ? e2.pop() : ot.call(e2, r2, 1), --this.size, 0));\n}, nt.prototype.get = function(t2) {\n  var e2 = this.__data__, r2 = rt(e2, t2);\n  return r2 < 0 ? void 0 : e2[r2][1];\n}, nt.prototype.has = function(t2) {\n  return rt(this.__data__, t2) > -1;\n}, nt.prototype.set = function(t2, e2) {\n  var r2 = this.__data__, o2 = rt(r2, t2);\n  return o2 < 0 ? (++this.size, r2.push([t2, e2])) : r2[o2][1] = e2, this;\n};\nvar at = z(r, \"Map\");\nfunction it(t2, e2) {\n  var r2, o2, n2 = t2.__data__;\n  return (\"string\" == (o2 = typeof (r2 = e2)) || \"number\" == o2 || \"symbol\" == o2 || \"boolean\" == o2 ? \"__proto__\" !== r2 : null === r2) ? n2[\"string\" == typeof e2 ? \"string\" : \"hash\"] : n2.map;\n}\nfunction st(t2) {\n  var e2 = -1, r2 = null == t2 ? 0 : t2.length;\n  for (this.clear(); ++e2 < r2; ) {\n    var o2 = t2[e2];\n    this.set(o2[0], o2[1]);\n  }\n}\nfunction ut(t2) {\n  var e2 = this.__data__ = new nt(t2);\n  this.size = e2.size;\n}\nst.prototype.clear = function() {\n  this.size = 0, this.__data__ = { hash: new et(), map: new (at || nt)(), string: new et() };\n}, st.prototype.delete = function(t2) {\n  var e2 = it(this, t2).delete(t2);\n  return this.size -= e2 ? 1 : 0, e2;\n}, st.prototype.get = function(t2) {\n  return it(this, t2).get(t2);\n}, st.prototype.has = function(t2) {\n  return it(this, t2).has(t2);\n}, st.prototype.set = function(t2, e2) {\n  var r2 = it(this, t2), o2 = r2.size;\n  return r2.set(t2, e2), this.size += r2.size == o2 ? 0 : 1, this;\n}, ut.prototype.clear = function() {\n  this.__data__ = new nt(), this.size = 0;\n}, ut.prototype.delete = function(t2) {\n  var e2 = this.__data__, r2 = e2.delete(t2);\n  return this.size = e2.size, r2;\n}, ut.prototype.get = function(t2) {\n  return this.__data__.get(t2);\n}, ut.prototype.has = function(t2) {\n  return this.__data__.has(t2);\n}, ut.prototype.set = function(t2, e2) {\n  var r2 = this.__data__;\n  if (r2 instanceof nt) {\n    var o2 = r2.__data__;\n    if (!at || o2.length < 199) return o2.push([t2, e2]), this.size = ++r2.size, this;\n    r2 = this.__data__ = new st(o2);\n  }\n  return r2.set(t2, e2), this.size = r2.size, this;\n};\nvar ct = r.Uint8Array;\nexport {\n  at as M,\n  ut as S,\n  ct as U,\n  S as a,\n  Q as b,\n  a as c,\n  st as d,\n  w as e,\n  C as f,\n  z as g,\n  J as h,\n  T as i,\n  x as j,\n  B as k,\n  p as l,\n  X as o,\n  y as t\n};\n//# sourceMappingURL=_Uint8Array-Cf-PTZCw.js.map\n","import { html, LitElement } from 'lit'\nimport { createRef, ref } from 'lit/directives/ref.js'\nimport { ContextProvider, ContextConsumer } from '@lit/context'\nimport '@auroratide/toggle-switch/lib/define.js'\nimport { loggerFactory } from '@/utils/logger.js'\nimport { addToGlobalBib } from '@/utils/bib.js'\nimport { dispatchPublicEvent } from '@/utils/events.js'\nimport { ConsentTokens } from './ConsentTokens.js'\nimport createConsentClient from './consentClient.js'\nimport { consentContext } from './consent-context.js'\nimport '../bib-button/bib-button-close.js'\nimport './bib-consent-consent-dialog.js'\nimport './bib-consent-preferences-dialog.js'\nimport { CONSENT_STATES, EVENT_NAMES, SERVER_MODE, SERVER_REQUEST_DEFAULT_TIMEOUT, SERVER_DEFAULT_URL } from './constants.js'\nimport { c } from '../../../dist/_Uint8Array-Cf-PTZCw.js'\n\nconst debug = loggerFactory('bib-consent', '#cd5300')\n\n/**\n * @typedef {'indeterminate' | 'determinate'} ConsentState\n */\n\n/**\n * The `BibConsent` class is a custom web component that provides a user interface for managing consent preferences.\n *\n * It includes the following functionality:\n * - Fetching and displaying the user's consent preferences from a server\n * - Allowing the user to change their consent preferences\n * - Saving the changed consent preferences to the server\n * - Providing a consent dialog and a preferences dialog for the user to interact with\n *\n * The component can be configured with the following properties:\n * - `serverUrl`: the URL of the server where the consent preferences are stored\n * - `serverRequestTimeout`: the timeout for requests to the server\n * - `[SERVER_MODE.LOCAL]`: a boolean indicating whether the component is running in local mode\n * - `debug`: a boolean indicating whether debug logging should be enabled\n * - `open`: a boolean indicating whether the consent dialog or preferences dialog is currently open\n *\n * The component uses the `@lit/context` library to manage the consent preferences as a shared context, and the `createConsentClient` function to interact with the server.\n * \n * @class BibConsent\n * @extends LitElement\n * @property {string} serverUrl - The URL of the server where the consent preferences are stored.\n * @property {number} serverRequestTimeout - The timeout for requests to the server.\n * @property {boolean} [SERVER_MODE.LOCAL] - A boolean indicating whether the component is running in local mode.\n * @property {boolean} debug - A boolean indicating whether debug logging should be enabled.\n * @property {boolean} open - A boolean indicating whether the consent dialog or preferences dialog is currently open.\n * @property {ConsentState} state - The current state of the BibConsent component, which can be one of the following values:\n *   - `indeterminate`: The user has not yet indicated their consent preferences.\n *   - `determinate`: The user has made their consent preferences.\n * @property {import('./ConsentTokens.js').ConsentTokens} consentTokens - The user's consent tokens.\n * @emits {CustomEvent} EVENT_NAMES.READY - Emitted when the consent client is ready.\n * @emits {CustomEvent} EVENT_NAMES.CHANGE - Emitted when the consent preferences are changed.\n * @emits {CustomEvent} context-request - Emitted when the context is requested.\n * @method connectedCallback - Initializes the component and sets up the necessary state and references.\n * @method close - Closes the current dialog and sets the `open` property to `false`.\n * @method show - Shows the consent dialog.\n * @method showPreferences - Shows the preferences dialog.\n * @method getTokens - Gets the user's consent tokens.\n * @method saveTokens - Saves the user's consent tokens to the server.\n * @method resetTokens - Resets the user's consent tokens to their default values.\n * @method render - Renders the component.\n */\nexport class BibConsent extends LitElement {\n  static properties = {\n    serverUrl: {\n      type: String,\n      attribute: 'server-url'\n    },\n    serverRequestTimeout: {\n      type: Number,\n      attribute: 'server-request-timeout'\n    },\n    [SERVER_MODE.LOCAL]: {\n      type: Boolean\n    },\n    state: {\n      type: String\n    },\n    debug: {\n      type: Boolean,\n      reflect: true\n    },\n    open: {\n      type: Boolean,\n      reflect: true\n    },\n  }\n\n  _consentClient\n  #consentTokens\n  #consentProvider\n  #consentConsumer\n  #state = CONSENT_STATES.INDETERMINATE\n  #consentDialogRef\n  #preferencesDialogRef\n\n  /**\n   * Initializes the `BibConsent` component, setting up the necessary state and references.\n   * \n   * The constructor performs the following tasks:\n   * - Calls the parent class constructor (`super()`)\n   * - Initializes the `open` property to `false`, indicating that no dialog is currently open\n   * - Sets the `currentDialog` property to `null`, as no dialog is currently open\n   * - Creates references to the consent dialog and preferences dialog using `createRef()`\n   * - Creates a `ContextProvider` instance for the consent context, with the component instance as the host and an initial value of `null`\n   * - Creates a `ContextConsumer` instance for the consent context, with the component instance as the host and the `savePreferences` method as the callback\n   */\n  constructor() {\n    super()\n    this.open = false\n    this.currentDialog = null\n    this.#consentDialogRef = createRef()\n    this.#preferencesDialogRef = createRef()\n    this.#consentProvider = new ContextProvider(this, { context: consentContext, initialValue: new ConsentTokens() })\n    this.#consentConsumer = new ContextConsumer(this, { context: consentContext, callback: this.savePreferences })\n  }\n\n  #dispatchPublicEvent(name, detail = null) {\n    dispatchPublicEvent(this, name, { detail })\n  }\n\n  /**\n   * Gets the current state of the BibConsent component.\n   * The state is determined by the user's input. Initially `indeterminate`, it turns `determinate` when the user has indicated their consent preferences.\n   * @readonly\n   * @returns {import('./constants.js').consentStateTypes} The current state of the BibConsent component, which can be one of the following values:\n   * - `indeterminate`: The user has not yet indicated their consent preferences.\n   * - `determinate`: The user has made their consent preferences.\n   */\n  get state() {\n    return this.#state\n  }\n\n  // /**\n  //  * Gets the user's consent tokens.\n  //  * @readonly\n  //  * @returns {import('./ConsentTokens.js').ConsentTokens} The user's consent tokens.\n  //  */\n  // get consentTokens() {\n  //   return this.#consentConsumer.value\n  // }\n\n  /**\n   * Initializes the `BibConsent` component, sets up the necessary state and references, and handles events related to the consent client.\n   * \n   * The `connectedCallback` method performs the following tasks:\n   * - Calls the parent class's `connectedCallback` method\n   * - Sets the `debug` property to `false` if it is not already defined\n   * - Sets the `serverUrl` property to `'https://bib.umontreal.ca/consent/server/'` if it is not already defined\n   * - Sets the `serverRequestTimeout` property to `SERVER_REQUEST_DEFAULT_TIMEOUT` if it is not already defined\n   * - Creates a `ConsentClient` instance and assigns it to the `_consentClient` property\n   * - Adds event listeners for the `EVENT_NAMES.READY` and `EVENT_NAMES.CHANGE` events on the `_consentClient` instance\n   * - Adds an event listener for the `context-request` event on the component's shadow root, which responds with the current tokens\n   */\n  async connectedCallback() {\n    super.connectedCallback()\n    this.debug = this.debug || false\n    this.serverUrl = this.serverUrl || SERVER_DEFAULT_URL\n    this.serverRequestTimeout = this.serverRequestTimeout || SERVER_REQUEST_DEFAULT_TIMEOUT\n\n    this._consentClient = await createConsentClient({ host: this, serverUrl: this.serverUrl, serverRequestTimeout: this.serverRequestTimeout, reflectEvents: true })\n\n    this._consentClient.addEventListener(EVENT_NAMES.READY, event => {\n\n      const { detail: consentData } = event\n\n      if (consentData.getState() === CONSENT_STATES.DETERMINATE) {\n        this.#setValue(consentData)\n      } else {\n        this.#show('consent')\n      }\n\n      this.#dispatchPublicEvent(EVENT_NAMES.READY, consentData.toObject())\n    })\n  }\n\n  #setValue(value) {\n    this.#consentProvider.setValue(value)\n    this.#state = this.#consentProvider.value.getState()\n  }\n\n  #debug() {\n    if (this.debug) {\n      debug(...arguments)\n    }\n  }\n\n  #close(emit = true) {\n    this.open = false\n    this.currentDialog?.close(emit)\n    this.currentDialog = null\n\n    if (emit) {\n      this.#dispatchPublicEvent(EVENT_NAMES.CLOSE)\n    }\n  }\n\n  /**\n   * Closes the current dialog, if any, and sets the `open` property to `false`.\n   */\n  close() {\n    this.#close()\n  }\n\n  #show(panel = 'consent') {\n\n    const validPanels = ['consent', 'preferences']\n\n    if (typeof panel !== 'string' && !validPanels.includes(panel)) {\n      throw new TypeError(`The panel argument must be a string of either values \\`${validPanels.join(` or `)}\\`. You provided \\`${panel}\\``, panel)\n    }\n\n    this.open = true\n\n    if (this.currentDialog) {\n      this.#debug('[#show] this.currentDialog', this.currentDialog)\n      this.currentDialog.close()\n    }\n\n    this.#debug('[show]', this.#consentDialogRef.value)\n    this.#debug('[show]', this.#preferencesDialogRef.value)\n    this.currentDialog = panel === 'consent' ? this.#consentDialogRef.value : this.#preferencesDialogRef.value\n    this.currentDialog.show()\n  }\n\n  /**\n   * Shows the consent dialog.\n   */\n  show() {\n    this.#show('consent')\n  }\n\n  /**\n   * Shows the preferences dialog.\n   */\n  showPreferences() {\n    this.#show('preferences')\n  }\n\n  /**\n   * Retrieves the user's consent tokens from the server.\n   *\n   * @returns {Promise<Object>} - A promise that resolves to the user's consent tokens.\n   */\n  async getTokens() {\n    this.#consentTokens = await this._consentClient.getConsentTokens()\n    return this.#consentTokens.toObject()\n  }\n\n  /**\n   * Saves the user's consent tokens to the server.\n   *\n   * @param {Object} preferences - The user's consent preferences.\n   * @returns {Promise<boolean>} - A promise that resolves to `true` if the preferences were saved successfully, or `false` if there was an error.\n   */\n\n  async saveTokens(tokens) {\n    this.#debug('[save] tokens: ', tokens)\n    const consentTokens = ConsentTokens.from(tokens)\n    try {\n      await this._consentClient.setConsentTokens(consentTokens)\n      this.#setValue(consentTokens)\n      return true\n    } catch (error) {\n      console.error('[savePreferences] error: ', error)\n      throw error\n    }\n  }\n\n  /**\n   * Resets the user's consent preferences to their default values.\n   *\n   * @returns {Promise<Object>} - A promise that resolves to the user's reset consent preferences.\n   */\n  async resetTokens() {\n    await this._consentClient.resetTokens()\n    const tokens = await this._consentClient.getConsentTokens()\n    this.#consentTokens = tokens\n    this.#dispatchPublicEvent(EVENT_NAMES.CHANGE, tokens.toObject())\n    return tokens\n  }\n\n  async #handleChangeEvent(event) {\n    // this.#debug('[#handleChangeEvent]', event)\n    const success = await this.saveTokens(event.detail)\n    // this.#debug('[#handleChangeEvent] success: ', success)\n\n    if (!success) {\n      // TODO: show error message\n      return\n    }\n\n    const tokens = await this.getTokens()\n    this.#dispatchPublicEvent(EVENT_NAMES.CHANGE, tokens)\n    this.#close()\n  }\n\n  #handleCloseEvent(event) {\n    this.#close(false)\n  }\n\n  render() {\n    return html`\n        <bib-consent-consent-dialog @intern:change=\"${this.#handleChangeEvent}\" @intern:show-preferences=\"${() => this.#show('preferences')}\" ${ref(this.#consentDialogRef)} @intern:close=\"${this.#handleCloseEvent}\"></bib-consent-consent-dialog>\n        <bib-consent-preferences-dialog @intern:change=\"${this.#handleChangeEvent}\" ${ref(this.#preferencesDialogRef)} @intern:close=\"${this.#handleCloseEvent}\"></bib-consent-preferences-dialog>\n    `\n  }\n}\n\nif (!window.customElements.get('bib-consent')) {\n  window.customElements.define('bib-consent', BibConsent)\n}\n\naddToGlobalBib('consent', {})"],"names":["value","this","o","s","setValue","t","i","Object","is","updateObservers","subscriptions","Map","disposer","has","set","delete","consumerHost","h","get","clearCallbacks","clear","e$1","Event","super","bubbles","composed","context","e","initialValue","onContextRequest","composedPath","host","stopPropagation","addCallback","callback","subscribe","onProviderRequest","Set","add","dispatchEvent","attachListeners","addController","addEventListener","global","self","Function","n","Symbol","l","prototype","r","hasOwnProperty","c","toString","a","toStringTag","b","u","t2","t3","e2","call","o2","n2","t4","l2","j","_","f","exec","keys","IE_PROTO","d","v","g","m","RegExp","replace","z","r2","e3","r3","test","E","propertyIsEnumerable","arguments","M","exports","nodeType","R","module","q","Buffer","isBuffer","L","N","V","process","W","require","types","binding","isTypedArray","Uint8Array","debug","loggerFactory","BibConsent","LitElement","constructor","_consentClient","consentTokens","consentProvider","consentConsumer","state","CONSENT_STATES","INDETERMINATE","consentDialogRef","preferencesDialogRef","open","currentDialog","createRef","ContextProvider","consentContext","ConsentTokens","ContextConsumer","savePreferences","connectedCallback","serverUrl","SERVER_DEFAULT_URL","serverRequestTimeout","SERVER_REQUEST_DEFAULT_TIMEOUT","createConsentClient","reflectEvents","EVENT_NAMES","READY","event","detail","consentData","getState","DETERMINATE","toObject","close","showPreferences","show","getConsentTokens","saveTokens","tokens","from","setConsentTokens","error","console","resetTokens","dispatchPublicEvent","CHANGE","html","ref","name","emit","CLOSE","panel","validPanels","includes","TypeError","join","handleChangeEvent","getTokens","handleCloseEvent","static","type","String","attribute","Number","SERVER_MODE","LOCAL","Boolean","reflect","window","customElements","define","addToGlobalBib"],"mappings":"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","x_google_ignoreList":[0,1]}