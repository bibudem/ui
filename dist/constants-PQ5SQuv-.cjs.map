{"version":3,"file":"constants-PQ5SQuv-.cjs","sources":["../node_modules/postmessage-promise/build/postmessage-promise.esm.js","../node_modules/boolify-string/node_modules/type-detect/index.js","../node_modules/boolify-string/lib/boolify-string.js","../src/components/bib-consent/utils.js","../src/components/bib-consent/constants.js","../src/utils/url.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\n/* eslint-disable no-lonely-if */\nvar CLIENT_RESPONSE = 'client_response';\nvar SERVER_RESPONSE = 'server_response';\nvar responseMap = {\n  server: {\n    receive: CLIENT_RESPONSE,\n    post: SERVER_RESPONSE\n  },\n  client: {\n    receive: SERVER_RESPONSE,\n    post: CLIENT_RESPONSE\n  }\n};\nvar KEY_METHODS = ['hand-shake', 'wave-hand', CLIENT_RESPONSE, SERVER_RESPONSE];\n/**\n * message channel\n * type: 'server' | 'client'\n */\nvar MessageChannel = /*#__PURE__*/_createClass(function MessageChannel(type, messageProxy, timeout) {\n  var _this = this;\n  _classCallCheck(this, MessageChannel);\n  _defineProperty(this, \"receiveMessage\", function (method, eventId, payload) {\n    if (method === responseMap[_this.type].receive) {\n      if (eventId && _this.messageResponse[eventId]) {\n        var response = _this.messageResponse[eventId];\n        delete _this.messageResponse[eventId];\n        response(payload);\n      }\n    } else {\n      // server postMessage and response\n      if (_this.listener) {\n        var _response = function _response(pload) {\n          _this.messageProxy.request(responseMap[_this.type].post, eventId, pload);\n        };\n        _this.listener(method, payload, _response);\n      } else {\n        console.warn('no message listener: ', method, payload);\n      }\n    }\n  });\n  _defineProperty(this, \"doPost\", function (_ref, method, payload) {\n    var resolve = _ref.resolve,\n      reject = _ref.reject,\n      eventId = _ref.eventId;\n    _this.messageResponse[eventId] = resolve;\n    try {\n      _this.messageProxy.request(method, eventId, payload);\n    } catch (e) {\n      delete _this.messageResponse[eventId];\n      reject();\n      throw e;\n    }\n  });\n  _defineProperty(this, \"listenMessage\", function (listener) {\n    _this.listener = listener;\n  });\n  _defineProperty(this, \"postMessage\", function (method, payload) {\n    if (KEY_METHODS.indexOf(method) >= 0) {\n      return Promise.reject(new Error(\"\".concat(method, \" is a protected key-method.\")));\n    }\n    return new Promise(function (resolve, reject) {\n      if (_this.destroyed) {\n        reject(new Error('message-channel had been destroyed!'));\n        return;\n      }\n      var ctimer = null;\n      var reswrap = function reswrap(value) {\n        clearTimeout(ctimer);\n        resolve(value);\n      };\n      var eventId = Math.random().toString().substr(3, 10);\n      _this.doPost({\n        resolve: reswrap,\n        reject: reject,\n        eventId: eventId\n      }, method, payload);\n      ctimer = setTimeout(function () {\n        if (_this.messageResponse) {\n          delete _this.messageResponse[eventId];\n        }\n        reject(new Error('postMessage timeout'));\n      }, _this.timeout || 20 * 1000);\n    });\n  });\n  _defineProperty(this, \"destroy\", function () {\n    _this.destroyed = true;\n    if (_this.unListen) {\n      _this.unListen();\n      _this.unListen = null;\n    }\n    _this.listener = null;\n    _this.messageResponse = null;\n    if (_this.messageProxy) {\n      _this.messageProxy.destroy();\n      _this.messageProxy = null;\n    }\n  });\n  this.type = type;\n  this.messageProxy = messageProxy;\n  this.listener = null;\n  this.messageResponse = {};\n  this.timeout = timeout;\n  this.unListen = this.messageProxy.listen(this.receiveMessage);\n});\n\n/* eslint-disable no-underscore-dangle */\nvar CLIENT_KEY$1 = 'postmessage-promise_client';\nvar SERVER_KEY = 'postmessage-promise_server';\nvar IDENTITY_KEY$1 = 'identity_key';\nvar identityMap = {\n  server: {\n    key: SERVER_KEY,\n    accept: CLIENT_KEY$1\n  },\n  client: {\n    key: CLIENT_KEY$1,\n    accept: SERVER_KEY\n  }\n};\nvar MessageProxy = /*#__PURE__*/_createClass(function MessageProxy(type, sourceInfo, eventFilter) {\n  var _this2 = this;\n  _classCallCheck(this, MessageProxy);\n  _defineProperty(this, \"listen\", function (fn) {\n    var _this = _this2;\n    var listener = function listener(event) {\n      if (_this.origin !== '*' && event.origin !== _this.origin || event.source !== _this.source || !event.data || event.data[IDENTITY_KEY$1] !== identityMap[_this.type].accept || event.data.channelId !== _this.channelId || !_this.eventFilter(event) || !event.data.method) {\n        return;\n      }\n      var _event$data = event.data,\n        eventId = _event$data.eventId,\n        method = _event$data.method,\n        payload = _event$data.payload;\n      fn(method, eventId, payload);\n    };\n    window.addEventListener('message', listener);\n    return function unListen() {\n      window.removeEventListener('message', listener);\n    };\n  });\n  _defineProperty(this, \"request\", function (method, eventId, payload) {\n    if (!_this2.source || _this2.source.closed) {\n      console.error('source closed.');\n      return;\n    }\n    _this2.source.postMessage(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({}, IDENTITY_KEY$1, identityMap[_this2.type].key), \"channelId\", _this2.channelId), \"eventId\", eventId), \"method\", method), \"payload\", payload), _this2.origin);\n  });\n  _defineProperty(this, \"destroy\", function () {\n    _this2.type = '';\n    _this2.origin = '';\n    _this2.source = null;\n    _this2.channelId = '';\n    _this2.eventFilter = null;\n  });\n  this.type = type;\n  var origin = sourceInfo.origin,\n    source = sourceInfo.source,\n    channelId = sourceInfo.channelId;\n  this.origin = origin;\n  this.source = source;\n  this.channelId = channelId;\n  this.eventFilter = eventFilter;\n});\n\nfunction ownKeys$1(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread$1(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys$1(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys$1(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction connectServer(sourceInfo, clientProxy, timeout, clientInfo) {\n  return new Promise(function (resolve, reject) {\n    var server = sourceInfo.source,\n      origin = sourceInfo.origin,\n      channelId = sourceInfo.channelId;\n    var SYN = 1;\n    var ACK = 0;\n    var seqnumber = Number(Math.random().toString().substr(3, 10));\n    var timer = null;\n    var startTime = new Date();\n    var unListen = null;\n    function handShake(method, eventId) {\n      var payload = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      if (method === 'hand-shake') {\n        // 判断状态\n        var _ref = payload || {},\n          sSYN = _ref.SYN,\n          sACK = _ref.ACK,\n          sSeq = _ref.seqnumber,\n          acknumber = _ref.acknumber;\n        // console.log('client hand shake', payload);\n        if (sSYN === 1 && sACK === 1 && acknumber === seqnumber + 1) {\n          // this is server acknowledgement\n          clearInterval(timer);\n          if (unListen) {\n            unListen();\n          }\n          clientProxy.request('hand-shake', 'hand-shake-event', {\n            clientInfo: clientInfo,\n            ACK: 1,\n            seqnumber: seqnumber + 1,\n            acknumber: sSeq + 1\n          });\n          resolve({\n            server: server,\n            origin: origin,\n            channelId: channelId,\n            serverInfo: payload.serverInfo,\n            clientInfo: clientInfo\n          });\n        }\n      }\n    }\n    unListen = clientProxy.listen(handShake);\n    var tryConnect = function tryConnect() {\n      if (!server || server.closed) {\n        clearInterval(timer);\n        if (unListen) {\n          unListen();\n        }\n        reject(new Error('server closed.'));\n        throw new Error('server closed.');\n      }\n      if (timeout) {\n        var endTime = new Date();\n        var usedTime = endTime - startTime;\n        if (usedTime > timeout) {\n          clearInterval(timer);\n          if (unListen) {\n            unListen();\n          }\n          reject(new Error('connect timeout.'));\n          throw new Error('connect timeout.');\n        }\n      }\n      clientProxy.request('hand-shake', 'hand-shake-event', {\n        clientInfo: clientInfo,\n        SYN: SYN,\n        ACK: ACK,\n        seqnumber: seqnumber\n      });\n    };\n    timer = setInterval(tryConnect, 100);\n  });\n}\n/**\n * create a message channel based on the channelId.\n * @param {*} clientInfo\n */\nfunction createChannel$1(serverProps, clientProxy, timeout) {\n  var server = serverProps.server,\n    _serverProps$serverIn = serverProps.serverInfo,\n    serverInfo = _serverProps$serverIn === void 0 ? {} : _serverProps$serverIn,\n    channelId = serverProps.channelId;\n  var messageChannel = new MessageChannel('client', clientProxy, timeout);\n  var destroy = function destroy() {\n    if (messageChannel) {\n      messageChannel.destroy();\n      messageChannel = null;\n    }\n    if (serverProps.destroy) {\n      serverProps.destroy();\n    }\n  };\n  // daemon\n  var watcher = null;\n  function watch() {\n    if (!server || server.closed) {\n      console.info('server closed.');\n      clearInterval(watcher);\n      destroy();\n    }\n  }\n  watcher = setInterval(watch, 2000);\n  return {\n    run: function run(resolve) {\n      resolve({\n        channelId: channelId,\n        serverInfo: serverInfo,\n        postMessage: function postMessage() {\n          if (messageChannel) {\n            var _messageChannel;\n            return (_messageChannel = messageChannel).postMessage.apply(_messageChannel, arguments);\n          }\n          return Promise.reject();\n        },\n        listenMessage: function listenMessage() {\n          if (messageChannel) {\n            var _messageChannel2;\n            (_messageChannel2 = messageChannel).listenMessage.apply(_messageChannel2, arguments);\n          }\n        },\n        destroy: destroy\n      });\n    }\n  };\n}\n\n/**\n * connect with server and create message channel\n * @param {*} serverObject\n * @param {*} options : { eventFilter, timeout } filter post messages\n */\nfunction callServer(serverObject) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (!serverObject) throw new Error('serverObject is null');\n  var server = serverObject.server,\n    origin = serverObject.origin;\n  var _options$eventFilter = options.eventFilter,\n    eventFilter = _options$eventFilter === void 0 ? function () {\n      return true;\n    } : _options$eventFilter,\n    _options$timeout = options.timeout,\n    timeout = _options$timeout === void 0 ? 20 * 1000 : _options$timeout,\n    _options$clientInfo = options.clientInfo,\n    clientInfo = _options$clientInfo === void 0 ? {} : _options$clientInfo,\n    onDestroy = options.onDestroy;\n  var channelId = Math.random().toString().substr(3, 10);\n  var sourceInfo = {\n    source: server,\n    origin: origin,\n    channelId: channelId\n  };\n  return new Promise(function (resolve, reject) {\n    if (!server || server.closed) {\n      reject(new Error('server closed'));\n      return;\n    }\n    var clientProxy = new MessageProxy('client', sourceInfo, eventFilter);\n    connectServer(sourceInfo, clientProxy, timeout, clientInfo).then(function (sProps) {\n      var serverProps = _objectSpread$1(_objectSpread$1({}, sProps), {}, {\n        destroy: function destroy() {\n          clientProxy = null;\n          if (onDestroy) {\n            onDestroy(sProps.serverInfo, sProps);\n          }\n        }\n      });\n      createChannel$1(serverProps, clientProxy, timeout).run(resolve);\n    })[\"catch\"](function (e) {\n      reject(e);\n    });\n  });\n}\n\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nvar CLIENT_KEY = 'postmessage-promise_client';\nvar IDENTITY_KEY = 'identity_key';\nvar TCP_TIMEOUT_INIT = 1000; // RFC6298 2.1 initial RTO value\nvar TCP_SYNACK_RETRIES = 5;\nfunction connectClient(eventFilter, serverInfo) {\n  return new Promise(function (resolve) {\n    var waitingType = 'syn'; // ack // finish\n    var SYN = 1;\n    var ACK = 1;\n    var seqnumber = Number(Math.random().toString().substr(3, 10));\n    var cSeqnumber = -1;\n    var timer = null;\n    var retries = TCP_SYNACK_RETRIES;\n    function handShake(event) {\n      if (!event.data || event.data[IDENTITY_KEY] !== CLIENT_KEY || !event.data.channelId || !event.data.method || event.data.method !== 'hand-shake' || !eventFilter(event)) {\n        return;\n      }\n      // 判断状态\n      var _ref = event.data.payload || {},\n        cSYN = _ref.SYN,\n        cACK = _ref.ACK,\n        cSeq = _ref.seqnumber,\n        cAcknumber = _ref.acknumber;\n      // console.log('server hand shake', event.data, waitingType, retries);\n      if (cSYN === 1 && cACK === 0) {\n        if (waitingType !== 'syn') {\n          return; // this is a syn timeout request\n        }\n        cSeqnumber = cSeq;\n        // client synchronous\n        waitingType = 'ack';\n        var fn = function fn() {\n          if (!event.source || event.source.closed) {\n            console.info('client closed and reset to listening.');\n            waitingType = 'syn';\n            clearTimeout(timer);\n            timer = null;\n            retries = TCP_SYNACK_RETRIES;\n            seqnumber = Number(Math.random().toString().substr(3, 10));\n            cSeqnumber = -1;\n            return false;\n          }\n          try {\n            event.source.postMessage(_defineProperty(_defineProperty(_defineProperty(_defineProperty({}, IDENTITY_KEY, 'postmessage-promise_server'), \"channelId\", event.data.channelId), \"method\", 'hand-shake'), \"payload\", {\n              serverInfo: serverInfo,\n              acknumber: cSeq + 1,\n              SYN: SYN,\n              ACK: ACK,\n              seqnumber: seqnumber\n            }), event.origin);\n          } catch (e) {\n            console.error(e);\n            return true;\n          }\n          return true;\n        };\n        var tryAck = fn();\n        if (!tryAck) return;\n        var retryFn = function retryFn() {\n          if (retries > 0) {\n            // waitingType = 'syn';\n            if (waitingType === 'ack') {\n              // eslint-disable-next-line operator-assignment\n              retries = retries - 1;\n              if (fn()) {\n                timer = setTimeout(retryFn, TCP_TIMEOUT_INIT);\n              }\n            }\n          } else {\n            // reset to a new listening\n            console.info('server three-way hand shake timeout and reset to listening.');\n            waitingType = 'syn';\n            clearTimeout(timer);\n            timer = null;\n            retries = TCP_SYNACK_RETRIES;\n            seqnumber = Number(Math.random().toString().substr(3, 10));\n            cSeqnumber = -1;\n          }\n        };\n        // TCP_TIMEOUT_INIT: waiting for the third hand shake until timeout.\n        if (!timer) {\n          timer = setTimeout(retryFn, TCP_TIMEOUT_INIT);\n        }\n      } else if (waitingType === 'ack') {\n        if (cACK === 1 && cSeq === cSeqnumber + 1 && cAcknumber === seqnumber + 1) {\n          // waiting for the third hand shake.\n          waitingType = 'finish';\n          clearTimeout(timer);\n          timer = null;\n          // client acknowledgement\n          window.removeEventListener('message', handShake);\n          var _event$data$payload = event.data.payload,\n            payload = _event$data$payload === void 0 ? {} : _event$data$payload;\n          resolve({\n            client: event.source,\n            origin: event.origin,\n            channelId: event.data.channelId,\n            serverInfo: serverInfo,\n            clientInfo: payload.clientInfo\n          });\n        }\n      } else ;\n    }\n    window.addEventListener('message', handShake);\n  });\n}\n/**\n * create a message channel based on the channelId.\n * @param {*} clientInfo\n */\nfunction createChannel(clientProps, eventFilter, timeout) {\n  var origin = clientProps.origin,\n    client = clientProps.client,\n    channelId = clientProps.channelId,\n    _clientProps$clientIn = clientProps.clientInfo,\n    clientInfo = _clientProps$clientIn === void 0 ? {} : _clientProps$clientIn;\n  var sourceInfo = {\n    origin: origin,\n    source: client,\n    channelId: channelId\n  };\n  var serverProxy = new MessageProxy('server', sourceInfo, eventFilter);\n  var messageChannel = new MessageChannel('server', serverProxy, timeout);\n  var destroy = function destroy() {\n    if (messageChannel) {\n      messageChannel.destroy();\n      messageChannel = null;\n    }\n    serverProxy = null;\n    if (clientProps.destroy) {\n      clientProps.destroy();\n    }\n  };\n  // daemon\n  var watcher = null;\n  function watch() {\n    if (!client || client.closed) {\n      console.info('client closed.');\n      clearInterval(watcher);\n      destroy();\n    }\n  }\n  watcher = setInterval(watch, 2000);\n  return {\n    run: function run(resolve) {\n      resolve({\n        channelId: channelId,\n        clientInfo: clientInfo,\n        postMessage: function postMessage() {\n          if (messageChannel) {\n            var _messageChannel;\n            return (_messageChannel = messageChannel).postMessage.apply(_messageChannel, arguments);\n          }\n          return Promise.reject();\n        },\n        listenMessage: function listenMessage() {\n          if (messageChannel) {\n            var _messageChannel2;\n            (_messageChannel2 = messageChannel).listenMessage.apply(_messageChannel2, arguments);\n          }\n        },\n        destroy: destroy\n      });\n    }\n  };\n}\n\n/**\n * start a server listening, each server listening can only connect with one client.\n * @param {*} options: { eventFilter, timeout } filter post messages\n */\nfunction startListening() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var _options$eventFilter = options.eventFilter,\n    eventFilter = _options$eventFilter === void 0 ? function () {\n      return true;\n    } : _options$eventFilter,\n    _options$timeout = options.timeout,\n    timeout = _options$timeout === void 0 ? 20 * 1000 : _options$timeout,\n    _options$serverInfo = options.serverInfo,\n    serverInfo = _options$serverInfo === void 0 ? {} : _options$serverInfo,\n    onDestroy = options.onDestroy;\n  return new Promise(function (resolve) {\n    connectClient(eventFilter, serverInfo).then(function (cProps) {\n      var clientProps = _objectSpread(_objectSpread({}, cProps), {}, {\n        destroy: function destroy() {\n          if (onDestroy) {\n            onDestroy(cProps.clientInfo, cProps);\n          }\n        }\n      });\n      createChannel(clientProps, eventFilter, timeout).run(resolve);\n    });\n  });\n}\n\n/**\n * Takes a URL and returns the origin. from dollarshaveclub/postmate\n * @param  {String} url The full URL being requested\n * @return {String}     The URLs origin\n */\nfunction resolveOrigin(url) {\n  var a = document.createElement('a');\n  a.href = url;\n  var protocol = a.protocol.length > 4 ? a.protocol : window.location.protocol;\n  // eslint-disable-next-line no-nested-ternary\n  var host = a.host.length ? a.port === '80' || a.port === '443' ? a.hostname : a.host : window.location.host;\n  return a.origin || \"\".concat(protocol, \"//\").concat(host);\n}\nfunction getIframeServer(container, targetUrl, name) {\n  var classListArray = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : [];\n  var root = typeof container !== 'undefined' ? container : document.body;\n  var origin = resolveOrigin(targetUrl);\n  var frame = document.createElement('iframe');\n  frame.name = name || '';\n  // eslint-disable-next-line prefer-spread\n  frame.classList.add.apply(frame.classList, classListArray);\n  root.appendChild(frame);\n  frame.src = targetUrl;\n  var iframeWindow = frame.contentWindow || frame.contentDocument.parentWindow;\n  return {\n    server: iframeWindow,\n    origin: origin,\n    frame: frame\n    // destroy: () => { if (frame) { frame.parentNode.removeChild(frame); } }\n  };\n}\nfunction getOpenedServer(targetUrl) {\n  var _window;\n  // window.opener.origin inaccessible when cross-origin\n  var origin = resolveOrigin(targetUrl);\n  for (var _len = arguments.length, opts = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    opts[_key - 1] = arguments[_key];\n  }\n  var openedWindow = (_window = window).open.apply(_window, [targetUrl].concat(opts));\n  return {\n    server: openedWindow,\n    origin: origin\n    // destroy: () => { if (openedWindow && openedWindow.close) { openedWindow.close(); } },\n  };\n}\nvar utils = {\n  resolveOrigin: resolveOrigin,\n  getIframeServer: getIframeServer,\n  getOpenedServer: getOpenedServer\n};\n\nvar index = {\n  callServer: callServer,\n  startListening: startListening,\n  utils: utils\n};\n\nexport { callServer, index as default, startListening, utils };\n","module.exports = require('./lib/type');\n","/*\n * boolify-string\n * https://github.com/sanemat/node-boolify-string\n *\n * Copyright (c) 2014 sanemat\n * Licensed under the MIT license.\n */\n\n'use strict';\nvar type = require('type-detect');\n\nmodule.exports = function(obj){\n  if (type(obj) !== 'string') {\n    return !!obj;\n  }\n  var value = obj.toLowerCase();\n  var bool;\n  switch (value){\n    case 'false':\n    case '0':\n    case 'undefined':\n    case 'null':\n    case '':\n    case 'n':\n    case 'no':\n    case 'off':\n      bool = false;\n      break;\n    default:\n      bool = true;\n      break;\n  }\n  return bool;\n};\n","import { utils as postmessageUtils } from 'postmessage-promise'\nimport { hasBooleanParam } from '@/utils/url.js'\nimport { PREFIX, SERVER_MODE, SERVER_REQUEST_DEFAULT_TIMEOUT } from './constants.js'\n\n/**\n * Creates a prefixed event name for the BIB consent module.\n * @param {string} prefix - The prefix to use for the event name.\n * @returns {function(string): string} - A function that takes an event name and returns the prefixed event name.\n */\nexport function createPrefixedEventName(prefix) {\n  return function (eventName) {\n    return `bib:${prefix}:${eventName}`\n  }\n}\n\n/**\n * Creates a prefixed key name for the BIB consent module.\n * @param {string} key - The key to be prefixed.\n * @returns {string} - The prefixed key name.\n */\nexport function getKeyName(key) {\n  return `${PREFIX}-${key}`\n}\n\n/**\n * Gets an iframe server for a given target URL.\n * @param {HTMLElement} [container=document.body] - The container element for the iframe.\n * @param {string} targetUrl - The target URL for the iframe.\n * @returns {object} - An object containing the iframe server, origin, and the iframe element.\n */\nexport function getIframeServer(\n  container,\n  targetUrl,\n) {\n  const root = typeof container !== 'undefined' ? container : document.body\n  const origin = postmessageUtils.resolveOrigin(targetUrl)\n  const iframeId = getKeyName('iframe')\n  let iframe\n  if (document.querySelector(`#${iframeId}`)) {\n    iframe = document.querySelector(`#${iframeId}`)\n  } else {\n    iframe = document.createElement('iframe')\n    iframe.id = iframeId\n\n    const isDebugOn = hasBooleanParam(targetUrl, 'debug')\n\n    if (!isDebugOn) {\n      iframe.ariaHidden = true\n      iframe.tabIndex = -1\n      iframe.hidden = true\n      iframe.style.setProperty('display', 'none')\n    } else {\n      iframe.style.cssText = 'width: 100%; height: 100%; border: 0;'\n    }\n\n    root.appendChild(iframe)\n    iframe.src = targetUrl\n  }\n\n  const iframeWindow = iframe.contentWindow || iframe.contentDocument.parentWindow\n\n  return {\n    server: iframeWindow,\n    origin,\n    iframe,\n  }\n}\n\n/**\n * Checks the server mode for a given client.\n * \n * If the client has no server URL, the function returns `SERVER_MODE.LOCAL`.\n * Otherwise, it checks if the server page exists by making a fetch request to the server URL.\n * If the request is successful (response.ok), the function returns `SERVER_MODE.REMOTE`.\n * If the request times out or fails, the function throws an error with the appropriate message.\n *\n * @param {object} client - The client object containing the server URL.\n * @param {number} [timeout=SERVER_REQUEST_DEFAULT_TIMEOUT] - The timeout in milliseconds for the server request.\n * @returns {string} - The server mode, either `SERVER_MODE.LOCAL` or `SERVER_MODE.REMOTE`.\n * @throws {Error} - If the server page cannot be located or the request fails.\n */\nexport async function getServerMode(client) {\n\n  const serverUrl = client.serverUrl\n  const timeout = client.serverRequestTimeout || SERVER_REQUEST_DEFAULT_TIMEOUT\n\n  if (!serverUrl) {\n    return SERVER_MODE.LOCAL\n  }\n\n  // Check if server page exists\n  const controller = new AbortController()\n  let response\n  let timeoutHandle\n\n  try {\n    timeoutHandle = setTimeout(() => {\n      console.warn(`Request timed out after ${timeout}ms. Aborting request...`)\n      controller.abort()\n    }, timeout)\n    response = await fetch(serverUrl, { signal: controller.signal })\n\n    if (response.ok) {\n      return SERVER_MODE.REMOTE\n    }\n  } catch (error) {\n    console.error(error)\n\n    if (controller.signal.aborted) {\n      throw new Error(`Unable to locate server page. The request timed out after ${timeout}ms. url: ${serverUrl.href}`)\n    }\n\n    throw new Error(`Unable to locate server page : ${serverUrl.href}.`, error)\n  } finally {\n    clearTimeout(timeoutHandle)\n  }\n\n  throw new Error(`Unable to locate server page. The request failed with status code ${response.status}. url: ${serverUrl.href}`)\n}","import { name as PKG_NAME } from '../../../package.json'\nimport { createPrefixedEventName } from './utils.js'\n\nconst eventName = createPrefixedEventName('consent')\n\nexport const DB_NAME = `${PKG_NAME}/consent`\nexport const DB_VERSION = 1\nexport const DB_STORE_NAME = 'consent'\n\nexport const EVENT_NAMES = {\n  READY: eventName('ready'),\n  UPDATE: eventName('update'),\n}\nexport const PREFIX = 'bib-consent'\n\nexport const SERVER_MODE = {\n  LOCAL: 'local',\n  REMOTE: 'remote'\n}\nexport const SERVER_REQUEST_DEFAULT_TIMEOUT = 500\n\n/**\n * @typedef {('analytics_consent'|'functionality_consent'|'ad_consent')} consentTypes\n */\n\n/**\n * @typedef {('granted' | 'denied')} ConsentValues\n */\n\n/**\n * @type {object} Tokens\n * @property {string} analytics_consent\n * @property {string} functionality_consent\n * @property {string} ad_consent\n */\nexport const DEFAULT_PREFERENCES = {\n  analytics_consent: null,\n  functionality_consent: null,\n  ad_consent: null\n}\n\n/**\n * @typedef {('determinate'|'indeterminate')} consentStateTypes\n */\n\nexport const CONSENT_STATES = {\n  INDETERMINATE: 'indeterminate',\n  DETERMINATE: 'determinate'\n}","import boolifyString from 'boolify-string'\n\nexport function hasBooleanParam(url, param) {\n  url = typeof url === 'string' ? new URL(url, location) : url\n\n  const booleanString = url.searchParams.get(param)\n\n  if (booleanString === null) {\n    return false\n  }\n\n  if (booleanString === '') {\n    return true\n  }\n\n  return boolifyString(booleanString)\n}\n\nexport function stringIsUrl(string) {\n  try {\n    new URL(string, location)\n    return true\n  } catch {\n    return false\n  }\n}\n\n// This is a modified version of https://www.npmjs.com/package/escape-string-regexp\nexport function patternMatchesOrigin(pattern, origin) {\n\n  const escapedPattern = pattern\n    .replace(/[.]/g, '\\\\$&')\n    .replace(/-/g, '\\\\x2d')\n    .replace(/[*]/g, '.*')\n\n  return new RegExp(`^${escapedPattern}$`, 'u').test(origin)\n}"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_createClass","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","CLIENT_RESPONSE","SERVER_RESPONSE","responseMap","server","receive","post","client","KEY_METHODS","MessageChannel","type","messageProxy","timeout","_this","this","method","eventId","payload","messageResponse","response","listener","pload","request","console","warn","_ref","resolve","reject","e","indexOf","Promise","Error","concat","destroyed","ctimer","Math","random","toString","substr","doPost","setTimeout","unListen","destroy","listen","receiveMessage","CLIENT_KEY$1","SERVER_KEY","IDENTITY_KEY$1","identityMap","accept","MessageProxy","sourceInfo","eventFilter","_this2","fn","event","origin","source","data","channelId","_event$data","window","addEventListener","removeEventListener","closed","postMessage","error","ownKeys$1","r","t","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","push","apply","_objectSpread$1","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","ownKeys","_objectSpread","IDENTITY_KEY","resolveOrigin","url","a","document","createElement","href","protocol","location","host","port","hostname","utils","getIframeServer","container","targetUrl","name","classListArray","undefined","root","body","frame","classList","add","appendChild","src","contentWindow","contentDocument","parentWindow","getOpenedServer","_window","_len","opts","Array","_key","open","require$$0","typeExports","bool","toLowerCase","createPrefixedEventName","prefix","eventName","getKeyName","PREFIX","DB_NAME","PKG_NAME","EVENT_NAMES","READY","UPDATE","SERVER_MODE","LOCAL","REMOTE","INDETERMINATE","DETERMINATE","analytics_consent","functionality_consent","ad_consent","serverObject","options","_options$eventFilter","_options$timeout","_options$clientInfo","clientInfo","onDestroy","clientProxy","seqnumber","Number","timer","startTime","Date","sSYN","SYN","sACK","ACK","sSeq","acknumber","clearInterval","serverInfo","setInterval","then","sProps","serverProps","_serverProps$serverIn","messageChannel","watcher","info","run","_messageChannel","listenMessage","_messageChannel2","catch","postmessageUtils","iframeId","iframe","querySelector","id","param","booleanString","URL","searchParams","get","boolifyString","style","cssText","ariaHidden","tabIndex","hidden","setProperty","s","async","serverUrl","serverRequestTimeout","controller","AbortController","timeoutHandle","abort","fetch","signal","ok","aborted","clearTimeout","status","pattern","escapedPattern","replace","RegExp","test","_options$serverInfo","waitingType","cSeqnumber","retries","handShake","cSYN","cACK","cSeq","cAcknumber","retryFn","_event$data$payload","cProps","clientProps","_clientProps$clientIn","serverProxy","string"],"mappings":"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","x_google_ignoreList":[0,1,2]}